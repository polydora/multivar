<!DOCTYPE html>
<html>
<head>
  <title>(Геометрическая) морфометрия</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: '(Геометрическая) морфометрия',
                        subtitle: 'Анализ и визуализация многомерных данных с использованием R',
                useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                        favIcon: '08.2_PCA_geometric_morphometrics_files/logo.png',
              },

      // Author information
      presenters: [
            {
        name:  'Марина Варфоломеева' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        
    slides > slide:not(.nobackground):before {
      font-size: 12pt;
      content: "";
      position: absolute;
      bottom: 20px;
      left: 60px;
      background: url(08.2_PCA_geometric_morphometrics_files/logo.png) no-repeat 0 50%;
      -webkit-background-size: 30px 30px;
      -moz-background-size: 30px 30px;
      -o-background-size: 30px 30px;
      background-size: 30px 30px;
      padding-left: 40px;
      height: 30px;
      line-height: 1.9;
    }
  </style>

  <link rel="stylesheet" href="assets/my_styles.css" type="text/css" />

</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="08.2_PCA_geometric_morphometrics_files/logo.png"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
          </hgroup>
  </slide>

<slide class=""><hgroup><h2>Анализ морфометрических данных при помощи анализа главных компонент</h2></hgroup><article  id="анализ-морфометрических-данных-при-помощи-анализа-главных-компонент">

<ul>
<li>Классический подход к морфометрии</li>
<li>Геометрическая морфометрия</li>
<li>Эволюция формы</li>
</ul>

<h3>Вы сможете</h3>

<ul>
<li>Проанализировать морфометрические данные корректно удалив влияние абсолютного размера</li>
<li>Рассказать, что происходит во время обобщенного прокрустова анализа</li>
<li>Проанализировать данные о координатах меток используя методы геометрической морфометрии</li>
<li>Понимать, каким образом происходит отображение филогенетического древа в пространство форм</li>
</ul>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Классический подход к морфометрии</h2></hgroup><article  id="классический-подход-к-морфометрии">

</article></slide><slide class=""><hgroup><h2>Классический подход к морфометрии</h2></hgroup><article  id="классический-подход-к-морфометрии-1">

<p>Для анализа формы различных структур анализируются расстояния между метками, а не их координаты.</p>

<p>Признаки сильно интегрированных структур, например частей скелета, лучше анализировать совместно друг с другом. Один из вариантов анализа - анализ главных компонент.</p>

</article></slide><slide class=""><hgroup><h2>Пример: морфометрия черепах</h2></hgroup><article  id="пример-морфометрия-черепах">

<p>Черепахи - единственные живые представители анапсид (череп не имеет височных окон). Морфология черепа важна для их систематики (Claude et al., 2004).</p>

<p>Данные - 24 разных измерения черепов черепах 122 ныне живущих пресноводных, морских и наземных видов и одного ископаемого.</p>

<img src='images/Fig30.1ZuurAED-mod.jpg' title='fig:'/><p class='caption'>Морфометрия черепах</p>

<div class="footnote">
Рис. 30.1 из Zuur et al. 2007</div>

</article></slide><slide class=""><hgroup><h2>Читаем данные</h2></hgroup><article  id="читаем-данные">

<pre class = 'prettyprint lang-r'>turt &lt;- read.table(&quot;data/turtles.txt&quot;, header = TRUE)
turt$Environment3 &lt;- factor(turt$Environment3, levels = c(0, 1, 2, 9), labels = c(&quot;Freshwater&quot;, &quot;Terrestrial&quot;, &quot;Marine&quot;, &quot;Fossil&quot;))
colnames(turt)</pre>

<pre >##  [1] &quot;nspecies&quot;     &quot;species_name&quot; &quot;Family&quot;       &quot;SuperFamily&quot; 
##  [5] &quot;Order&quot;        &quot;Environment&quot;  &quot;Environment3&quot; &quot;D1&quot;          
##  [9] &quot;D2&quot;           &quot;D3&quot;           &quot;D4&quot;           &quot;D5&quot;          
## [13] &quot;D6&quot;           &quot;D7&quot;           &quot;D8&quot;           &quot;D9&quot;          
## [17] &quot;D10&quot;          &quot;D11&quot;          &quot;D12&quot;          &quot;D13&quot;         
## [21] &quot;D14&quot;          &quot;D15&quot;          &quot;D16&quot;          &quot;D17&quot;         
## [25] &quot;D18&quot;          &quot;D19&quot;          &quot;D20&quot;          &quot;D21&quot;         
## [29] &quot;D22&quot;          &quot;D23&quot;          &quot;D24&quot;</pre>

<div class="footnote">
Данные из Zuur et al. 2007</div>

</article></slide><slide class=""><hgroup><h2>Чтобы понять, нужно ли стандартизовать исходные данные, построим боксплот</h2></hgroup><article  id="чтобы-понять-нужно-ли-стандартизовать-исходные-данные-построим-боксплот">

<pre class = 'prettyprint lang-r'>boxplot(x = turt[8:31])</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>

<ul class = 'build'>
<li>Наверное, лучше стандартизовать</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Делаем анализ главных компонент по стандартизованным данным</h2></hgroup><article  id="делаем-анализ-главных-компонент-по-стандартизованным-данным">

<pre class = 'prettyprint lang-r'>library(vegan)</pre>

<pre >## Loading required package: permute</pre>

<pre >## Loading required package: lattice</pre>

<pre >## This is vegan 2.5-7</pre>

<pre class = 'prettyprint lang-r'>turt_pca &lt;- rda(turt[, 8:31], scale = TRUE)</pre>

</article></slide><slide class=""><hgroup><h2>Сколько компонент достаточно для описания данных?</h2></hgroup><article  id="сколько-компонент-достаточно-для-описания-данных">

<pre class = 'prettyprint lang-r'>eig &lt;- eigenvals(turt_pca)[1:5]
eig*100/sum(eig) # доля объясненной изменчивости</pre>

<pre >##   PC1   PC2   PC3   PC4   PC5 
## 86.76  6.94  3.07  1.96  1.27</pre>

<pre class = 'prettyprint lang-r'>screeplot(turt_pca, bstick = TRUE)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>

<ul class = 'build'>
<li>Первая компонента объясняет очень много, остальные - почти ничего. Одной компоненты достаточно?</li>
<li>Нет! Не все так просто.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Что странного в этой картинке?</h2></hgroup><article  id="что-странного-в-этой-картинке">

<pre class = 'prettyprint lang-r'>biplot(turt_pca, display = &quot;species&quot;, scaling = 2)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/biplot-raw-1.png" width="576" style="display: block; margin: auto;" /></p>

<ul>
<li><p>Как вы думаете, почему у всех переменных большие нагрузки по первой компоненте?</p></li>
<li><p>Что отражает первая компонента?</p></li>
</ul>

</article></slide><slide class=""><hgroup><h2>При анализе сырых морфометрических данных первая компонента отражает размер объектов и, возможно, немножко - их форму</h2></hgroup><article  id="при-анализе-сырых-морфометрических-данных-первая-компонента-отражает-размер-объектов-и-возможно-немножко---их-форму">

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/biplot-raw-1.png" width="576" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Классические способы избавиться от влияния размера:</h2></hgroup><article  id="классические-способы-избавиться-от-влияния-размера">

<ul>
<li>использовать одну из исходных переменных как оценку &ldquo;размера&rdquo;: использовать в PCA остатки от регрессий исходных признаков от &ldquo;размера&rdquo;</li>
<li>стандартизация исходных данных при помощи деления на величину &ldquo;размера&rdquo; для каждого образца (корень из суммы квадратов измерений)</li>
<li>сделать двойное центрирование (логарифмированных) исходных данных</li>
<li>и т.д. и т.п.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Двойное центрирование</h2></hgroup><article  id="двойное-центрирование">

<p>Нам достаточно центрировать строки, т.к. столбцы будут центрированы автоматически в процессе анализа главных компонент.</p>

<pre class = 'prettyprint lang-r'># Функция, которая может центрировать вектор
center &lt;- function(x){
  x - mean(x, na.rm = TRUE)
}
# применяем эту функцию к каждой строке
dbcent &lt;- t(apply(turt[, 8:31], 1, center))
# получившийся датафрейм пришлось транспонировать,
# поскольку apply() результаты от каждой строки
# возвращает в виде столбцов</pre>

</article></slide><slide class=""><hgroup><h2>После двойного центрирования большие собственные числа у нескольких компонент</h2></hgroup><article  id="после-двойного-центрирования-большие-собственные-числа-у-нескольких-компонент">

<pre class = 'prettyprint lang-r'>turt_db_pca &lt;- rda(dbcent)
eig_db &lt;- eigenvals(turt_db_pca)[1:5]
eig_db*100/sum(eig_db)</pre>

<pre >##   PC1   PC2   PC3   PC4   PC5 
## 65.48 23.12  6.36  3.13  1.91</pre>

<pre class = 'prettyprint lang-r'>screeplot(turt_db_pca, bstick = TRUE)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>После двойного центрирования у переменных высокие нагрузки на несколько компонент, влияние размера удалено</h2></hgroup><article  id="после-двойного-центрирования-у-переменных-высокие-нагрузки-на-несколько-компонент-влияние-размера-удалено">

<pre class = 'prettyprint lang-r'>biplot(turt_db_pca, display = &quot;species&quot;, scaling = 2)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>

<p>Интерпретируем как обычно: компонента отражает несколько признаков</p>

</article></slide><slide class=""><hgroup><h2>Ординация черепах по морфометрии черепов (двойное центрирование данных)</h2></hgroup><article  id="ординация-черепах-по-морфометрии-черепов-двойное-центрирование-данных">

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/tradit-pca-1.png" width="960" style="display: block; margin: auto;" /></p>

<ul>
<li>У пресноводных большие D12 и D13, и маленькая D2. У морских наоборот</li>
<li>Ископаемая черепаха похожа на нынешних морских</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Код для графика ординации черепах по морфометрии черепов</h2></hgroup><article  id="код-для-графика-ординации-черепах-по-морфометрии-черепов">

<pre class = 'prettyprint lang-r'>op &lt;- par(mfrow = c(1, 2), mar = c(4, 4, 0.5, 0.5), cex = 1.3)
biplot(turt_db_pca, display = &quot;species&quot;, scaling = 2)
# цвета для графика факторных координат
colvec &lt;- c(&quot;orange2&quot;, &quot;limegreen&quot;, &quot;steelblue&quot;, &quot;red3&quot;)
# пустой график
plot(turt_db_pca, type = &quot;n&quot;, scaling = 1)
# точки, раскрашенные по уровням фактора turt$Environment3
points(turt_db_pca, display = &quot;sites&quot;, scaling = 1, pch = 21, 
       col = colvec[turt$Environment3], bg = colvec[turt$Environment3])
# легенда
legend(&quot;bottomright&quot;, legend = levels(turt$Environment3), bty = &quot;n&quot;, pch = 21, 
       col = colvec, pt.bg = colvec)
par(op)</pre>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Геометрическая морфометрия</h2></hgroup><article  id="геометрическая-морфометрия">

<h3>Но настоящие джедаи теперь анализируют координаты меток, а не расстояния между ними!</h3>

</article></slide><slide class=""><hgroup><h2>Пример: Форма головы Апалачских саламандр рода <em>Plethodon</em></h2></hgroup><article  id="пример-форма-головы-апалачских-саламандр-рода-plethodon">

<p><em>Plethodon jordani</em> и <em>P.teyahalee</em> встречаются вместе и раздельно. В совместно обитающих популяциях меняется форма головы обоих видов. В разных группах популяций этот процесс параллельно приводит к одинаковым результатам. По-видимому, одной из причин параллельной эволюции может быть межвидовая конкуренция (Adams, 2004, 2010).</p>

<div class="columns-2">
<img src='images/PlethodoJordaniJordansSalamander-JohnPClare-Flickr.jpg' title='fig:'/><p class='caption'><em>Plethodon jordani</em></p>

<p><em>Plethodon jordani</em> - Jordan’s Salamander by <a href='https://flic.kr/p/dMfNq6' title=''>John P Clare on Flickr</a></p>

<img src='images/PlethodonCfTeyahalee-squamatologist-Flickr.jpg' title='fig:'/><p class='caption'><em>Plethodon</em> cf. <em>teyahalee</em></p>

<p><em>Plethodon</em> cf. <em>teyahalee</em> by <a href='https://flic.kr/p/8m82g6' title=''>squamatologist on Flickr</a></p></div>

</article></slide><slide class=""><hgroup><h2>Морфометрия головы саламандр</h2></hgroup><article  id="морфометрия-головы-саламандр">

<img src='images/measurements-Adams2004.jpg' title='fig:'/><p class='caption'>Схема измерений</p>

<pre class = 'prettyprint lang-r'># install.packages(&quot;geomorph&quot;, dependencies = TRUE)
library(geomorph)</pre>

<pre >## Loading required package: RRPP</pre>

<pre >## Loading required package: rgl</pre>

<pre >## This build of rgl does not include OpenGL functions.  Use
##  rglwidget() to display results, e.g. via options(rgl.printRglwidget = TRUE).</pre>

<pre >## Loading required package: Matrix</pre>

<pre class = 'prettyprint lang-r'>data(plethodon)
str(plethodon, vec.len = 2, give.attr = F)</pre>

<pre >## List of 5
##  $ land   : num [1:12, 1:2, 1:40] 8.89 9.27 ...
##  $ links  : num [1:14, 1:2] 4 3 2 1 1 ...
##  $ species: Factor w/ 2 levels &quot;Jord&quot;,&quot;Teyah&quot;: 1 1 1 1 1 ...
##  $ site   : Factor w/ 2 levels &quot;Allo&quot;,&quot;Symp&quot;: 2 2 2 2 2 ...
##  $ outline: num [1:3631, 1:2] 0.399 0.4 ...</pre>

<div class="footnote">
рис. из Adams, 2004, 2010</div>

</article></slide><slide class=""><hgroup><h2>Сырые морфометрические данные еще не выравнены</h2></hgroup><article  id="сырые-морфометрические-данные-еще-не-выравнены">

<p>Все образцы разного размера и разной ориентации в пространстве. На этом графике — два образца для примера.</p>

<pre class = 'prettyprint lang-r'>plotRefToTarget(plethodon$land[, , 1], plethodon$land[, ,10],
                method = &quot;points&quot;, mag = 1, 
                links = plethodon$links)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Если нарисовать не выравненные образцы, получится полная каша. Что делать?</h2></hgroup><article  id="если-нарисовать-не-выравненные-образцы-получится-полная-каша.-что-делать">

<p>Слева - три образца, справа - все. Жирные точки - центроиды соответствующих меток</p>

<pre class = 'prettyprint lang-r'>op &lt;- par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
plotAllSpecimens(plethodon$land[, , 1:3], links=plethodon$links)
plotAllSpecimens(plethodon$land,links=plethodon$links)
par(op)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Геометрическая морфометрия</h2></hgroup><article  id="геометрическая-морфометрия-1">

<ol>
<li>Влияние размера удаляется при помощи обобщенного прокрустова анализа (масштабирование, поворот и сдвиг координат)</li>
<li>Преобразованные координаты меток используются как признаки объектов (конкретных особей) в анализе главных компонент. Получается морфопространство. Главные компоненты отражают изменения формы.</li>
</ol>

<ul>
<li>можно получить усредненную форму для любой группы выравненных координат</li>
<li>можно сравнить форму любой особи со средней формой</li>
<li>можно проследить изменение формы вдоль осей главных компонент</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Прокрустов анализ</h2></hgroup><article  id="прокрустов-анализ">

<img src='images/Theseus-Procrustes.jpg' title='fig:'/><p class='caption'>Прокрустово ложе</p>

<p><small>Тезей убивает разбойника Прокруста (источник <a href='https://mrpsmythopedia.wikispaces.com/Procrustes' title=''>https://mrpsmythopedia.wikispaces.com/Procrustes</a>)</small></p>

</article></slide><slide class=""><hgroup><h2>Шаг 1. Выравниваем данные при помощи обобщенного прокрустова анализа</h2></hgroup><article  id="шаг-1.-выравниваем-данные-при-помощи-обобщенного-прокрустова-анализа">

<p>Generalized Procrustes Analysis (GPA)</p>

<p>Минимизируем сумму квадратов расстояний между одноименными метками, меняя масштаб, поворачивая и сдвигая координаты. Вот как это выглядит на данных про черепах:</p>

<img src='images/Fig30.8ZuurAED-mod.jpg' title='fig:'/><p class='caption'>Прокрустово преобразование</p>

<div class="footnote">
Рис. 30.8 из Zuur et al. 2007 с изменениями</div>

</article></slide><slide class=""><hgroup><h2>Выравниваем головы саламандр</h2></hgroup><article  id="выравниваем-головы-саламандр">

<pre class = 'prettyprint lang-r'>gpa &lt;- gpagen(plethodon$land, print.progress = FALSE)
plotAllSpecimens(gpa$coords,links=plethodon$links)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Усредненная форма</h2></hgroup><article  id="усредненная-форма">

<pre class = 'prettyprint lang-r'>ref &lt;- mshape(gpa$coords) 
plotRefToTarget(ref, ref, method = &quot;TPS&quot;, links = plethodon$links)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Можем посмотреть, как отличается любой из образцов от усредненной формы</h2></hgroup><article  id="можем-посмотреть-как-отличается-любой-из-образцов-от-усредненной-формы">

<p>Изменение формы можно представить графически несколькими способами</p>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/comparis-1.png" width="960" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Код для графиков сравнения образцов с усредненной формой</h2></hgroup><article  id="код-для-графиков-сравнения-образцов-с-усредненной-формой">

<pre class = 'prettyprint lang-r'># матрица, в которой хранится разметка общего графика
m &lt;- matrix(data = c(1, 2,
                     3, 3),
            nrow = 2, ncol = 2, byrow = TRUE)
l &lt;- layout(m, heights = c(1, 1), widths = c(1, 1))
# layout.show(l) # можно просмотреть разметку

# Графики
op &lt;- par( mar = c(0, 0, 0, 0))
# 1) изменение конфигурации обозначено векторами
plotRefToTarget(ref, gpa$coords[, , 11],
                method = &quot;vector&quot;, mag = 1,
                links = plethodon$links)
# 2) формы обозначены точками
plotRefToTarget(ref, gpa$coords[, , 11],
                method = &quot;points&quot;, mag = 1,
                links = plethodon$links)
# 3) сплайн
plotRefToTarget(ref, gpa$coords[, , 11],
                method = &quot;TPS&quot;, mag = 1,
                links = plethodon$links)
par(op)</pre>

</article></slide><slide class=""><hgroup><h2>Шаг 2. Создаем морфопространство</h2></hgroup><article  id="шаг-2.-создаем-морфопространство">

<p><strong>Анализ главных компонент по координатам меток для выравненных образцов</strong>. Главные компоненты отражают изменения формы.</p>

<pre class = 'prettyprint lang-r'>ord &lt;- gm.prcomp(gpa$coords)
plot(ord, main = &quot;PCA&quot;)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-13-1.png" width="960" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Можно раскрасить по группам</h2></hgroup><article  id="можно-раскрасить-по-группам">

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/pca-p-1.png" width="960" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Код для графика ординации и для легенды</h2></hgroup><article  id="код-для-графика-ординации-и-для-легенды">

<pre class = 'prettyprint lang-r'>op &lt;- par(mar = c(4, 4, 1, 1))
gp &lt;- as.factor(paste(plethodon$species, plethodon$site)) # группа должна быть фактором
# задаем соответствие цветов уровням фактора
colvec &lt;- c(&quot;Jord Allo&quot; = &quot;yellow2&quot;, 
            &quot;Jord Symp&quot; = &quot;orange&quot;, 
            &quot;Teyah Allo&quot; = &quot;green4&quot;, 
            &quot;Teyah Symp&quot; = &quot;green1&quot;)
# вектор цветов в порядке заданном фактором gp
colvec &lt;- colvec[match(gp, names(colvec))]
# график
plot(ord, bg = colvec, pch = 21, col = &quot;grey20&quot;)
# легенда
legend(&quot;topright&quot;, legend = levels(gp), 
                   bty = &quot;n&quot;, pch = 21, 
                   col = &quot;grey20&quot;, 
                   pt.bg = levels(as.factor(colvec)))
par(op)</pre>

</article></slide><slide class=""><hgroup><h2>Доля объясненной изменчивости и факторные координаты</h2></hgroup><article  id="доля-объясненной-изменчивости-и-факторные-координаты">

<pre class = 'prettyprint lang-r'>expl &lt;- round(ord$d[1:5]/sum(ord$d) * 100, 1) # Доля изменчивости объясненной 1-5 компонентами
head(ord$x[, 1:5]) # Факторные координаты по 1-5 компонентам</pre>

<pre >##       Comp1  Comp2     Comp3    Comp4    Comp5
## 1 -0.036993 0.0512 -0.001697 -0.00313 -0.01094
## 2 -0.000749 0.0594  0.000137 -0.00277 -0.00812
## 3  0.005600 0.0742 -0.005261 -0.00503 -0.00275
## 4 -0.013481 0.0646 -0.045844 -0.00789  0.00982
## 5 -0.033470 0.0686  0.013629  0.00736  0.02235
## 6 -0.005214 0.0616 -0.029933 -0.00575 -0.02406</pre>

</article></slide><slide class=""><hgroup><h2>Чтобы легко рисовать изменения формы вдоль главной компоненты нам понадобится функция</h2></hgroup><article  class="smaller" id="чтобы-легко-рисовать-изменения-формы-вдоль-главной-компоненты-нам-понадобится-функция">

<pre class = 'prettyprint lang-r'>plot_shape_change &lt;- function(ord, ref_shape, PC,
                              horiz = TRUE,
                              gridPars = NULL, ...){
  if(horiz){
    op &lt;- par(mfrow = c(1, 2), mar = c(0, 0 , 0, 0))
    plotRefToTarget(M1 = ref_shape, M2 = ord$shapes[[PC]]$min,
                    gridPars = gridPars,  ...)
    plotRefToTarget(M1 = ref_shape, M2 = ord$shapes[[PC]]$max,
                    gridPars = gridPars, ...)
    par(op)
    } else {
     op &lt;- par(mfrow = c(2, 1), mar = c(0, 0 , 0, 0))
     plotRefToTarget(M1 = ref_shape, M2 = ord$shapes[[PC]]$max,
                     gridPars = gridPars,  ...)
     plotRefToTarget(M1 = ref_shape, M2 = ord$shapes[[PC]]$min,
                     gridPars = gridPars, ...)
     par(op)
    }
}</pre>

</article></slide><slide class=""><hgroup><h2>Изменение формы вдоль главных компонент относительно средней формы</h2></hgroup><article  class="smaller" id="изменение-формы-вдоль-главных-компонент-относительно-средней-формы">

<pre class = 'prettyprint lang-r'>plot_shape_change(ord, ref_shape = gpa$consensus, PC = 1, links = plethodon$links, method = &quot;TPS&quot;) </pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p>

<pre class = 'prettyprint lang-r'>plot_shape_change(ord, ref_shape = gpa$consensus, PC = 2, links = plethodon$links, method = &quot;TPS&quot;, horiz = FALSE) </pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-17-1.png" width="288" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Можно нарисовать одновременно изменение формы вдоль обеих компонент и ординацию</h2></hgroup><article  id="можно-нарисовать-одновременно-изменение-формы-вдоль-обеих-компонент-и-ординацию">

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/forms-pca-p-1.png" width="960" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Код для графика</h2></hgroup><article  id="код-для-графика">

<pre class = 'prettyprint lang-r'>my_gridPar &lt;- gridPar(tar.pt.size = 0.6, grid.lwd = 0.7)
library(cowplot)
gg_pca &lt;- plot_grid(
  ~ plot_shape_change(ord, ref_shape = gpa$consensus, PC = 2,
                      horiz = FALSE, links = plethodon$links,
                      method = &quot;TPS&quot;, gridPars = my_gridPar),
  ~ {plot(ord, bg = colvec, pch = 21, col = &quot;grey20&quot;)
    legend(&quot;topright&quot;, legend = levels(gp),  bty = &quot;n&quot;, 
           pch = 21, col = &quot;grey20&quot;, 
           pt.bg = levels(as.factor(colvec)))},
  NULL,
  ~ plot_shape_change(ord, ref_shape = gpa$consensus, PC = 1,
                      links = plethodon$links, 
                      method = &quot;TPS&quot;, gridPars = my_gridPar),
  ncol = 2, rel_heights = c(5, 1), rel_widths = c(1, 4)
)

gg_pca</pre>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Эволюционные изменения формы</h2></hgroup><article  id="эволюционные-изменения-формы">

</article></slide><slide class=""><hgroup><h2>Фило-морфо пространство</h2></hgroup><article  id="фило-морфо-пространство">

<p>Если у вас есть данные о средних формах для каждого вида и данные о филогении (из любого источника), то можно изобразить эволюционные изменения формы</p>

<p>Этапы:</p>

<ol>
<li>Выравнивание средних форм для таксонов при помощи обобщенного прокрустова анализа</li>
<li>Ординация таксонов при помощи анализа главных компонент</li>
<li>Поиск анцестральных состояний количественных признаков (форм) методом максимального правдоподобия</li>
<li>Наложение филогенетического дерева и анцестральных форм на график ординации</li>
</ol>

</article></slide><slide class=""><hgroup><h2>Фило-морфопространство саламандр рода Plethodon</h2></hgroup><article  id="фило-морфопространство-саламандр-рода-plethodon">

<p>P. serratus, P. cinereus, P. shenandoah, P. hoffmani, P. virginia, P. nettingi, P. hubrichti, P. electromorphus, P. richmondi</p>

<pre class = 'prettyprint lang-r'>data(plethspecies)
str(plethspecies, vec.len = 2, give.attr = F)</pre>

<pre >## List of 2
##  $ land: num [1:11, 1:2, 1:9] 0.217 0.259 ...
##  $ phy :List of 4
##   ..$ edge       : int [1:16, 1:2] 10 10 11 12 12 ...
##   ..$ Nnode      : int 8
##   ..$ tip.label  : chr [1:9] &quot;P_serratus&quot; &quot;P_cinereus&quot; ...
##   ..$ edge.length: num [1:16] 15.17 3.84 ...</pre>

</article></slide><slide class=""><hgroup><h2>Выравниваем средние формы для видов</h2></hgroup><article  id="выравниваем-средние-формы-для-видов">

<pre class = 'prettyprint lang-r'>species_gpa &lt;- gpagen(plethspecies$land) #GPA-alignment</pre>

<pre >## 
## Performing GPA
## 
  |                                                                  
  |                                                            |   0%
  |                                                                  
  |===============                                             |  25%
  |                                                                  
  |==============================                              |  50%
  |                                                                  
  |============================================================| 100%
## 
## Making projections... Finished!</pre>

</article></slide><slide class=""><hgroup><h2>Наложение филогенетического дерева и анцестральных форм на график PCA ординации</h2></hgroup><article  id="наложение-филогенетического-дерева-и-анцестральных-форм-на-график-pca-ординации">

<p>Филоморфопространство</p>

<pre class = 'prettyprint lang-r'>pca_with_phylo &lt;- gm.prcomp(species_gpa$coords, phy = plethspecies$phy)
plot(pca_with_phylo, phylo = TRUE)</pre>

<p><img src="08.2_PCA_geometric_morphometrics_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Take-home messages</h2></hgroup><article  id="take-home-messages">

<ul>
<li>Классический подход к морфометрии

<ul>
<li>анализируют расстояния между метками</li>
<li>для корректного анализа необходимо удалить влияние размера и оставить форму, но сделать это корректно почти невозможно</li>
</ul></li>
<li>Геометрическая морфометрия

<ul>
<li>анализируют координаты меток</li>
<li>различные конфигурации выравнивают при помощи обобщенного прокрустова анализа</li>
<li>преобразованные координаты точек используют в анализе главных компонент</li>
<li>чтобы визуализировать эволюцию форм, можно наложить филогенетическое древо на ординацию</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Дополнительные ресурсы</h2></hgroup><article  id="дополнительные-ресурсы">

<ul>
<li>Bookstein, F.L., 2003. Morphometric Tools for Landmark Data Geometry and Biology. Cambridge University Press.</li>
<li>Claude, J., 2008. Morphometrics With R. Springer.</li>
<li>GEOL G562 - Geometric Morphometrics [WWW Document], n.d. URL <a href='http://www.indiana.edu/~g562/PBDB2013/' title=''>http://www.indiana.edu/~g562/PBDB2013/</a> (accessed 4.1.15).</li>
<li>Zelditch, M., Swiderski, D.L., Sheets, D.H., Fink, W.L., 2004. Geometric Morphometrics for Biologists. Academic Press.</li>
<li>Zuur, A.F., Ieno, E.N., Smith, G.M., 2007. Analysing ecological data. Springer.</li>
</ul></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>

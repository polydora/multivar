<!DOCTYPE html>
<html>
<head>
  <title>Анализ связи между наборами данных</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Анализ связи между наборами данных',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                        favIcon: '03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/logo.png',
              },

      // Author information
      presenters: [
            {
        name:  'Вадим Хайтов, Марина Варфоломеева, Анастасия Лянгузова' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <script src="site_libs/header-attrs-2.20/header-attrs.js"></script>
  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    details > summary > p:only-child {
      display: inline;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { color: #008000; } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { color: #008000; font-weight: bold; } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        
    slides > slide:not(.nobackground):before {
      font-size: 12pt;
      content: "";
      position: absolute;
      bottom: 20px;
      left: 60px;
      background: url(03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/logo.png) no-repeat 0 50%;
      -webkit-background-size: 30px 30px;
      -moz-background-size: 30px 30px;
      -o-background-size: 30px 30px;
      background-size: 30px 30px;
      padding-left: 40px;
      height: 30px;
      line-height: 1.9;
    }
  </style>

  <link rel="stylesheet" href="assets/my_styles.css" type="text/css" />

</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/logo.png"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      
      <p data-config-presenter><!-- populated from slide_config.json --></p>
          </hgroup>
  </slide>

<style>
div#before-column p.forceBreak {
    #break-before: column;
}
div#after-column p.forceBreak {
    break-after: column;
}
</style>

<slide class=""><hgroup><h2>Вы сможете</h2></hgroup><article  id="вы-сможете">

<ul>
<li>Количественно оценить степень взаимосвязи между несколькими наборами данных.</li>
<li>Протестировать гипотезу о наличии в данных некоторого специфического паттерна, используя метод модельных матриц.</li>
<li>Найти оптимальное сочетание признаков, не вошедших в ординацию, которые &ldquo;объясняют&rdquo; характер взаиморасположения точек на ординации.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Ординация растительности на пастбищах северных оленей</h2></hgroup><article  id="ординация-растительности-на-пастбищах-северных-оленей" class="columns-2">

<p>Данные из работы<br/>Väre, H., Ohtonen, R. and Oksanen, J. (1995)</p>

<p><img src="images/Vare%20et%20al%201995%20map.png" style="height:330px;"/></p>

<p><small>из Väre, Ohtonen &amp; Oksanen (1995)</small></p>

<p><br><br><br><br/></p>

<pre class = 'prettyprint lang-r'>library(vegan)
library(ggplot2)
data(varespec)
data(varechem)</pre>

<p>Два набора данных:</p>

<ul>
<li><code>varespec</code> — Описание растительности (обилия отдельных видов);</li>
<li><code>varechem</code> — Параметры среды на участках (Концентрации веществ).</li>
</ul>

<p><br /><br /><br /><br /><br /><br /><br /></p>

</article></slide><slide class=""><hgroup><h2>Задание</h2></hgroup><article  id="задание">

<ol>
<li>Используя средства пакета &ldquo;ggplot2&rdquo;, постройте ординацию описаний растительности в осях MDS.</li>
<li>Раскрасьте точки в соответствии с концентрацией Al.</li>
<li>На диаграмме приведите величину стресса для данной ординации</li>
</ol>

<p>Hint. В качестве меры различия используйте коэффициент Брея-Куртиса.</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение" class="columns-2 smaller">

<!-- ```{r, eval=FALSE} -->

<!-- veg_ord <- metaMDS(varespec, trace = 0) -->

<!-- veg_MDS <- as.data.frame(veg_ord$points) -->

<!-- ``` -->

<!-- ```{r message=FALSE, eval=FALSE} -->

<!-- library(ggplot2) -->

<!-- Pl_mds <-  -->

<!--   ggplot(veg_MDS, aes(x = MDS1, y = MDS2,  -->

<!--                     fill = varechem$Al))  + -->

<!--   geom_point(shape=21, size =4)+ -->

<!--   ggtitle(paste("Stress = ", round(veg_ord$stress, 2))) +  -->

<!--   theme_bw() + -->

<!--   theme(legend.position = "bottom") + -->

<!--   labs(fill = "Aluminium concentration") + -->

<!--   scale_fill_gradient(high = "red", low = "yellow")  -->

<!-- ``` -->

<pre class = 'prettyprint lang-r'>veg_ord &lt;- metaMDS(varespec, trace = FALSE)
veg_MDS &lt;- as.data.frame(veg_ord$points)</pre>

<pre class = 'prettyprint lang-r'>library(ggplot2)
Pl_mds &lt;- 
  ggplot(veg_MDS, aes(x = MDS1, y = MDS2, 
                    fill = varechem$Al))  +
  geom_point(shape=21, size =4)+
  ggtitle(paste(&quot;Stress = &quot;, 
                round(veg_ord$stress, 2))) + 
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;) +
  labs(fill = &quot;Aluminium concentration&quot;) +
  scale_fill_gradient(high = &quot;red&quot;, 
                      low = &quot;yellow&quot;) </pre>

<p><br /><br /><br /><br /><br /><br /><br /></p>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Анализ связи с переменными c помощью функции envfit()</h2></hgroup><article  id="анализ-связи-с-переменными-c-помощью-функции-envfit">

<p><strong>Задание</strong>: Постройте рисунок, который будет отражать связь полученной ординации с изученными переменными среды (датасет <code>varechem</code>).</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-1" class="columns-2 smaller">

<pre class = 'prettyprint lang-r'>env_fit &lt;- envfit(veg_ord ~ ., data = varechem)</pre>

<pre class = 'prettyprint lang-r'>ordiplot(veg_ord, display = &quot;site&quot;)
plot(env_fit)</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-6-1.png" width="432" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Анализ связи с переменными c помощью функции ordisurf()</h2></hgroup><article  id="анализ-связи-с-переменными-c-помощью-функции-ordisurf">

<p><strong>Задание</strong>: Постройте рисунок, который будет отражать связь полученной ординации с концентрацией Mn и Al.</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-2">

<pre class = 'prettyprint lang-r'>env_fit2 &lt;- envfit(veg_ord ~ Al + Mn, data = varechem)
plot(veg_ord, display = &quot;site&quot;)
plot(env_fit2, col = &quot;red&quot;)
ordisurf(veg_ord, varechem$Al, add = TRUE, col=&quot;blue&quot;)
ordisurf(veg_ord, varechem$Mn, add = TRUE, col=&quot;green&quot;)</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/fig1-1.png" width="384" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2><strong>Вопрос:</strong></h2></hgroup><article  id="вопрос">

<p>Сможем ли мы на основе данных, полученных с помощью функций <code>envfit()</code> или <code>ordisurf()</code>, построить оптимальную модель, описывающую связь структуры сообществ и параметров среды?</p>

</article></slide><slide class=""><hgroup><h2>Оценка связи между данными</h2></hgroup><article  id="оценка-связи-между-данными">

<p>Можно оценивать отношения между:</p>

<ul class = 'build'>
<li>исходными данными (следующие лекции);</li>
</ul>

<ul class = 'build'>
<li>матрицами попарных расстояний между объектами в исходных данных (<strong>текущая лекция!</strong>).</li>
</ul>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Тест Мантела</h2></hgroup><article  id="тест-мантела">

</article></slide><slide class=""><hgroup><h2>Постановка проблемы</h2></hgroup><article  id="постановка-проблемы">

<p>Нам необходимо оценить связаны ли два набора данных и оценить силу этой связи.</p>

<p><strong>Похожие задачи:</strong></p>

<blockquote>
<p>Зависит ли растительность от параметров среды?<br/></p>
</blockquote>

<blockquote>
<p>Связаны ли морфологические признаки и экспрессия генов?<br/></p>
</blockquote>

<blockquote>
<p>Связаны ли характеристики паразитов и хозяев?</p>
</blockquote>

<p>и т.п.</p>

</article></slide><slide class=""><hgroup><h2>Метод сравнения сопряженных матриц, описывающих попарные расстояния (или сходства), был предложен Натаном Мантелом</h2></hgroup><article  id="метод-сравнения-сопряженных-матриц-описывающих-попарные-расстояния-или-сходства-был-предложен-натаном-мантелом">

<center>

<img src="images/Mantel.png" style="height:350px;"/>

</center>

</article></slide><slide class=""><hgroup><h2>Корреляция матриц сходства/различия</h2></hgroup><article  id="корреляция-матриц-сходстваразличия">

<p>Если две матрицы сопряжены, то меры сходства/различия в одной матрице должны быть подобны мерам сходства/различия в другой матрице.</p>

<pre class = 'prettyprint lang-r'>dist_com &lt;- vegdist(varespec, method = &quot;bray&quot;)
dist_chem &lt;- vegdist(varechem, method = &quot;euclidean&quot;)</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Корреляция матриц сходства/различия</h2></hgroup><article  id="корреляция-матриц-сходстваразличия-1" class="columns-2">

<p><img src="images/mantels_stat.png" style="height:400px;"/></p>

<p><small>из Legendre, Legendre (2012)</small></p>

<p>Вопрос: Как можно определить статистическую значимость полученного коэффициента корреляции?</p>

<ul class = 'build'>
<li>Внимание! Значимость этой корреляции нельзя оценивать как для обычной корреляции, например функцией <code>cor.test()</code> или по таблице пороговых значений коэффициента корреляции.</li>
</ul>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Пермутационные методы оценки статистической значимости</h2></hgroup><article  id="пермутационные-методы-оценки-статистической-значимости" class="smaller">

<p style="text-align:right">

<p>– Друг мой, – отвечал Диоталлеви, – ты никогда ничего не поймешь. Да, это правда, что Тора – я имею в виду, разумеется, видимую Тору – есть лишь одна из перестановок-<em>пермутаций</em> букв, составляющих вековечную Тору, какою создал ее Творец и какой ее дал Адаму. Умберто Эко<br/>&ldquo;Маятник Фуко&rdquo;</p>

</p>

</article></slide><slide class=""><hgroup><h2>Тестирование простейшей гипотезы</h2></hgroup><article  id="тестирование-простейшей-гипотезы">

<p>Создадим две выборки из популяций с нормальным распределением признака, с заведомо отличающимися средними значениями.</p>

<pre class = 'prettyprint lang-r'>set.seed(12345)

male &lt;- rnorm(100, 130, 5)
female &lt;- rnorm(100, 129,5)</pre>

</article></slide><slide class=""><hgroup><h2>Частотное распределение этих двух выборок выглядит так:</h2></hgroup><article  id="частотное-распределение-этих-двух-выборок-выглядит-так">

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Сравним две выборки с помощью t-критерия Стьюдента</h2></hgroup><article  id="сравним-две-выборки-с-помощью-t-критерия-стьюдента">

<p>Какая статистика используется в t-критерии?</p>

<ul class = 'build'>
<li>\(t= \frac {X1-X2} {SE}\)</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Сравним две выборки с помощью t-критерия Стьюдента</h2></hgroup><article  id="сравним-две-выборки-с-помощью-t-критерия-стьюдента-1">

<p>Результаты</p>

<pre class = 'prettyprint lang-r'>t &lt;- t.test(male, female)
t</pre>

<pre >## 
##  Welch Two Sample t-test
## 
## data:  male and female
## t = 3, df = 196, p-value = 0.009
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  0.516 3.484
## sample estimates:
## mean of x mean of y 
##       131       129</pre>

<p>Что означает выражение p-value = 0.009?</p>

</article></slide><slide class=""><hgroup><h2>Пермутационный подход к тестированию</h2></hgroup><article  id="пермутационный-подход-к-тестированию">

<p>Если две сравниваемые выборки взяты из одной совокупности (справедлива \(H_0\)), то обмен элементами между ними ничего не изменит. Степень различия между выборками (значение статистики) останется более или менее тем же самым.</p>

<p class="forceBreak">

</p>

<p><strong>Пермутации — это перестановки.</strong></p>

<p>Полное количество пермутаций (при равном количестве объектов в двух группах) будет вычисляться по следующей формуле:</p>

<p>\[K= \frac{(2n)!}{(2!(n!)^2)}\]</p>

<p>При большом объеме выборок это огромное число!</p>

<p>В таких случаях используют метод Монте-Карло.</p>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную">

<p>Применим этот метод (на очень примитивном уровне) к нашим двум выборкам, описывающим размеры мальчиков и девочек (векторы male и female).</p>

<pre class = 'prettyprint lang-r'>head (male)</pre>

<pre >## [1] 133 134 129 128 133 121</pre>

<pre class = 'prettyprint lang-r'>head (female)</pre>

<pre >## [1] 130 123 131 122 130 126</pre>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную-1">

<p>Введем статистику:</p>

<p>\[t= \frac {X_1 - X_2}{ \sqrt {SE_1^2+SE_2^2}}\]</p>

<p>Вычислим значение этой статистики при сравнении векторов male и female:</p>

<pre class = 'prettyprint lang-r'>SE_m &lt;- sd(male) / sqrt(length(male))
SE_f &lt;- sd(female) / sqrt(length(female))
t_initial &lt;- (mean(male) - mean(female))/sqrt(SE_m^2 + SE_f^2)</pre>

<p>Полученное значение t = 2.657.</p>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную-2">

<p>При пермутациях мы должны поменять местами, например, male[10] = 125.403 и female[20] = 128.655. А еще лучше поменять случайное количество элементов одной выборки на случайное количество элементов из другой выборки.</p>

<pre class = 'prettyprint lang-r'>f &lt;- female
m &lt;- male
num_perm &lt;- sample(1:100, 1)
order_m &lt;- sample(1:100, num_perm)
order_f &lt;- sample(1:100, num_perm)
f[order_f] &lt;- male[order_f]
m[order_m] &lt;- female[order_f]
SE_m &lt;- sd(m) / sqrt(length(m))
SE_f &lt;- sd(f) / sqrt(length(f))
t_p &lt;- (mean(m) - mean(f)) / sqrt(SE_m^2 + SE_f^2)</pre>

<p>После этой пермутации у нас получилось значение \(t_{perm}\) = -2.332, а исходное значение было t = 2.657.</p>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную-3">

<p>Теперь нужно провести процедуру пермутации много раз и получить распределение значений статистики \(t_{perm}\).</p>

<pre class = 'prettyprint lang-r'>Nperm = 10000
tperm &lt;- rep(NA, Nperm)

set.seed(12345)
for (i in 1:(Nperm-1)) 
  {
  BOX &lt;- c(male ,female)
  ord &lt;- sample(1:200, 200)
  f &lt;- BOX[ord[1:100]]
  m &lt;- BOX[ord[101:200]]
  SE_m &lt;- sd(m) / sqrt(length(m))
  SE_f &lt;- sd(f) / sqrt(length(f))
  tperm[i]=(mean(m) - mean(f))/sqrt(SE_m^2 + SE_f^2)
}

head(tperm)</pre>

<pre >## [1] -0.508 -0.420 -2.240 -0.781  0.901 -1.152</pre>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную-4">

<p>Посмотрим в конец этого вектора.</p>

<pre class = 'prettyprint lang-r'>tail(tperm)</pre>

<pre >## [1] -0.4985  1.6344 -0.7864 -0.0249  1.0292      NA</pre>

<p>Последнее 10000-е значение не заполнено!<br/>В него надо вписать исходное, полученное до пермутаций, значение t = 2.657. Это необходимо, так как мы тестируем гипотезу о принадлежности этого значения случайному распределению.</p>

<pre class = 'prettyprint lang-r'>tperm [Nperm] &lt;- t_initial</pre>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную-5">

<p>Построим частотное распределение пермутированных значений статистики \(t_{perm}\).</p>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Пермутационный метод вручную</h2></hgroup><article  id="пермутационный-метод-вручную-6">

<p>Рассчитаем величину уровня значимости \(p_{perm}= \frac{N_{t_{perm}&gt;=t}}{N_{perm}}\):</p>

<pre class = 'prettyprint lang-r'>p_perm &lt;- length(tperm[tperm &gt;= t_initial] | tperm[tperm 
                                                   &lt;= -t_initial]) / Nperm</pre>

<p>Мы получили уровень значимости \(p_{perm}\) = 0.005.</p>

<p>Сравним его с уровнем значимости, вычисленным с помощью параметрического t-критерия p = 0.009.</p>

<p>Они оба близки и оба выявляют значимые различия!</p>

</article></slide><slide class=""><hgroup><h2>Пермутационная оценка коэффициента корреляции</h2></hgroup><article  id="пермутационная-оценка-коэффициента-корреляции">

<p>Создадим два скоррелированных вектора.</p>

<pre class = 'prettyprint lang-r'>library(MASS)
set.seed(1234567)
mu &lt;- c(10, 20) #Вектор средних значений
Sigma &lt;- matrix(.7, nrow=2, ncol=2) #Ковариационная матрица
diag(Sigma) &lt;- c(1, 3)

dat &lt;- as.data.frame(mvrnorm(n=100, mu=mu, Sigma=Sigma)) 

# Датафрейм с двумя скоррелированными переменными
cor.test(dat$V1, dat$V2, method = &quot;spearman&quot;)</pre>

<pre >## 
##  Spearman&#39;s rank correlation rho
## 
## data:  dat$V1 and dat$V2
## S = 87860, p-value = 0.0000009
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##   rho 
## 0.473</pre>

</article></slide><slide class=""><hgroup><h2>Пермутационная оценка коэффициента корреляции</h2></hgroup><article  id="пермутационная-оценка-коэффициента-корреляции-1">

<pre class = 'prettyprint lang-r'>library(coin)

spearman_test(V1 ~ V2, data = dat, 
              distribution = approximate(nresample=9999))</pre>

<pre >## 
##  Approximative Spearman Correlation Test
## 
## data:  V1 by V2
## Z = 5, p-value &lt;0.0001
## alternative hypothesis: true rho is not equal to 0</pre>

</article></slide><slide class=""><hgroup><h2>Проверка статистической значимости Мантеловской корреляции</h2></hgroup><article  id="проверка-статистической-значимости-мантеловской-корреляции" class="smaller">

<p>Для оценки достоверности Мантеловской корреляции применяется пермутационная процедура. Эта процедура реализована в функции <code>mantel()</code> из пакета <code>vegan</code>.</p>

<p>Возвращаемся к данным с начала лекции: описание растительности и параметров среды (их матрицы сходства/различия).</p>

<pre class = 'prettyprint lang-r'>options(digits=4)
mant &lt;- mantel(dist_com, dist_chem, method=&quot;pearson&quot;, permutations = 9999)
mant</pre>

<pre >## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist_com, ydis = dist_chem, method = &quot;pearson&quot;,      permutations = 9999) 
## 
## Mantel statistic r: 0.182 
##       Significance: 0.023 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.113 0.144 0.179 0.214 
## Permutation: free
## Number of permutations: 9999</pre>

<p>Вероятность наблюдать такое значение при условии, что верна \(H_0\), равна 0.0231.</p>

</article></slide><slide class=""><hgroup><h2>Частная Мантеловская корреляция</h2></hgroup><article  id="частная-мантеловская-корреляция" class="columns-2">

<p><img src="images/Vare%20et%20al%201995%20map.png" style="height:350px;"/></p>

<p><small>из Väre, Ohtonen &amp; Oksanen (1995)</small></p>

<p>В материале есть одна проблема</p>

<ul class = 'build'>
<li>Cходство между отдельными описаниями может быть обусловлено не только их биологическими свойствами, но и тем, что они просто располагаются ближе друг к другу в пространстве.<br/></li>
<li>Корреляция между биологическими признаками и химическими должна оцениваться при учете еще одной матрицы — <strong>Матрицы географических расстояний</strong>.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Частная Мантеловская корреляция</h2></hgroup><article  id="частная-мантеловская-корреляция-1" class="smaller">

<pre class = 'prettyprint lang-r'>mantel_partial &lt;- mantel.partial(xdis = dist_com, ydis = dist_chem, 
                                 zdis = dist_geo, method = &quot;pearson&quot;,
                                 permutations = 9999)
mantel_partial</pre>

<pre >## 
## Partial Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel.partial(xdis = dist_com, ydis = dist_chem, zdis = dist_geo,      method = &quot;pearson&quot;, permutations = 9999) 
## 
## Mantel statistic r: 0.182 
##       Significance: 0.019 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.109 0.143 0.173 0.207 
## Permutation: free
## Number of permutations: 9999</pre>

</article></slide><slide class=""><hgroup><h2>Частная Мантеловская корреляция</h2></hgroup><article  id="частная-мантеловская-корреляция-2" class="smaller">

<pre >## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist_com, ydis = dist_chem, method = &quot;pearson&quot;,      permutations = 9999) 
## 
## Mantel statistic r: 0.182 
##       Significance: 0.023 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.113 0.144 0.179 0.214 
## Permutation: free
## Number of permutations: 9999</pre>

<pre >## 
## Partial Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel.partial(xdis = dist_com, ydis = dist_chem, zdis = dist_geo,      method = &quot;pearson&quot;, permutations = 9999) 
## 
## Mantel statistic r: 0.182 
##       Significance: 0.019 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.109 0.143 0.173 0.207 
## Permutation: free
## Number of permutations: 9999</pre>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Подбор оптимальной модели: процедура BIO-ENV</h2></hgroup><article  id="подбор-оптимальной-модели-процедура-bio-env">

</article></slide><slide class=""><hgroup><h2>Постановка задачи</h2></hgroup><article  id="постановка-задачи">

<p>Необходимо выбрать предикторы, которые наилучшим образом объясняют поведение биологической системы.</p>

<p>\(NB!\) Эта задача аналогична задачам, ставящимся в регрессионном анализе.</p>

<p>К. Кларком и M. Эйнсвортом был предложен метод BIO-ENV (Clarke, Ainsworth, 1993). Это непараметрический аналог пошагового регрессионного анализа.</p>

</article></slide><slide class=""><hgroup><h2>Процедура BIO-ENV</h2></hgroup><article  id="процедура-bio-env">

<p>В этом анализе есть две сцепленные матрицы:</p>

<ul class = 'build'>
<li>Зависимая матрица (BIO) - матрица геоботанических описаний.</li>
<li>Матрица-предиктор (ENV) - матрица химических параметров.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Алгоритм процедуры BIO-ENV</h2></hgroup><article  id="алгоритм-процедуры-bio-env">

<ul class = 'build'>
<li>Расчёт матрицы взаимных расстояний между объектами для зависимой матрицы \(D_{BIO}\) (с помощью vegdist). Используются все переменные.</li>
<li>Вычисление <strong>всех</strong> возможных матриц взаимных расстояний между объектами для всех возможных комбинаций признаков матрицы ENV — \(D_{ENV_i}\). <strong>ВНИМАНИЕ!</strong> В результате матриц будет \(2^p-1\), т.к. матрица-предиктор имеет \(p\) переменных.</li>
<li>Расчёт мантеловской корреляции между каждой из матриц \(D_{ENV_i}\) (предиктор) и матрицей \(D_{BIO}\) (описания).</li>
<li>Находится матрица \(D_{ENV_i}\), имеющая максимальное значение мантеловской корреляции.</li>
<li>Вывод признаков матрицы ENV, на основе которых получена максимально подобная матрица \(D_{ENV_i}\).</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Функция bioenv() из пакета vegan</h2></hgroup><article  id="функция-bioenv-из-пакета-vegan">

<pre class = 'prettyprint lang-r'>BioEnv &lt;- bioenv(varespec, varechem, method = &quot;spearman&quot;, index = &quot;bray&quot;)</pre>

<pre class = 'prettyprint lang-r'>BioEnv</pre>

<pre >## 
## Call:
## bioenv(comm = varespec, env = varechem, method = &quot;spearman&quot;,      index = &quot;bray&quot;) 
## 
## Subset of environmental variables with best correlation to community data.
## 
## Correlations:    spearman 
## Dissimilarities: bray 
## Metric:          euclidean 
## 
## Best model has 5 parameters (max. 14 allowed):
## N P Al Mn Baresoil
## with correlation  0.4494</pre>

</article></slide><slide class=""><hgroup><h2>Оценка достоверности результатов</h2></hgroup><article  id="оценка-достоверности-результатов">

<p><strong>Внимание!</strong> Не надо оценивать достоверность результата процедуры BIO-ENV путем оценки достоверности мантеловской корреляции между \(D_{BIO}\) и матрицей, полученной в результате применения BIO-ENV \(D_{ENV}\). <strong>Это будет жульничеством</strong>, так как это уже максимально подобная матрица. <br /><br /> Для оценки достоверности полученного результата применяется пермутационный метод, основанный на <strong>многократном повторении самой процедуры BIO-ENV</strong>. <br /><br /> <strong>Внимание!</strong> Это занимает очень много времени.</p>

</article></slide><slide class=""><hgroup><h2>Алгоритм оценки достоверности применения процедуры BIO-ENV</h2></hgroup><article  id="алгоритм-оценки-достоверности-применения-процедуры-bio-env" class="columns-2">

<p><img src="images/BIOENV.png" style="height:450px;"/></p>

<ol>
<li>Применяем процедуру BIO-ENV и находим лучшее сочетание переменных в матрице-предикторе (ENV).</li>
<li>Пермутируем зависимую матрицу (BIO).</li>
<li>Применяем процедуру BIO-ENV к пермутированной матрице и вновь находим наилучшее сочетание, сохраняем значение Мантеловской корреляции.</li>
<li>Повторяем шаги 2 и 3 многократно, получаем распределение пермутационных статистик.</li>
<li>Вычисляем уровень значимости способом, принятым при пермутационной оценке.</li>
</ol>

</article></slide><slide class=""><hgroup><h2>Трактовка результатов BIO-ENV?</h2></hgroup><article  id="трактовка-результатов-bio-env">

<p>Задание: Постройте ординацию описаний в осях nMDS и отразите на этой диаграмме векторы, соответствующие результатам процедуры <code>BIO-ENV</code>.</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-3">

<pre class = 'prettyprint lang-r'>plot(veg_ord, display = &quot;site&quot;)
plot(envfit(veg_ord ~ N + P + Al + Mn + Baresoil, data = varechem))</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-28-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Тестирование гипотезы о соответствии ожидаемому паттерну: метод модельных матриц</h2></hgroup><article  id="тестирование-гипотезы-о-соответствии-ожидаемому-паттерну-метод-модельных-матриц">

</article></slide><slide class=""><hgroup><h2>Пример: Динамика сообществ мидиевых банок</h2></hgroup><article  id="пример-динамика-сообществ-мидиевых-банок" class="columns-2 smaller">

<p>Существуют ли направленные многолетние изменения в размерной структуре поселений мидий и в структуре сообщества (Khaitov, 2013)?</p>

<pre class = 'prettyprint lang-r'>com &lt;- read.csv(&quot;data/mussel_beds.csv&quot;, 
                sep=&#39;;&#39;, header = T)

ascam &lt;- read.csv(&quot;data/ASCAM.csv&quot;, 
                  sep=&#39;;&#39;, header = T)</pre>

<p><code>com</code> — усредненные данные по обилию 12 видов для 3 мидиевых банок (Vor2, Vor4, Vor5).</p>

<p><code>ascam</code> — (averaged size class abundance matrix) средние плотности поселения мидий разных размеров (6] размерных классов).</p>

<p><img src="images/musselbed.png" alt="Мидиевая банка" width="450" height="350"/></p>

</article></slide><slide class=""><hgroup><h2>Задание</h2></hgroup><article  id="задание-1" class="columns-2 smaller">

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/dynam-2-1.png" width="480" style="display: block; margin: auto;" /></p>

<p>Рассмотрите многолетние изменения структуры сообщества и размерной структуры мидий на мидиевой банке Vor2.</p>

<p>Постройте рисунок, аналогичный приведенному на данном слайде.</p>

<p>Hint 1. Прологарифмируйте данные.</p>

<p>Hint 2. Примените наиболее подходящий коэффициент для оценки различий между объектами.</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-4">

<h3>Ординация</h3>

<pre class = 'prettyprint lang-r'>library(vegan)

log_com &lt;- decostand(com[,-c(1:3)], method = &quot;log&quot;)

vor2_log_com &lt;- log_com[com$Bank == &quot;Vor2&quot;,]

log_ascam &lt;- decostand(ascam[, -c(1:2)], method = &quot;log&quot;)

mds_vor2_com &lt;- as.data.frame(metaMDS(vor2_log_com)$points)

vor2_log_ascam &lt;- log_ascam[ascam$Bank == &quot;Vor2&quot;,]

mds_vor2_ascam &lt;- as.data.frame(metaMDS(vor2_log_ascam, 
                                        distance = &quot;euclid&quot;)$points)</pre>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-5">

<h3>График ординации</h3>

<pre class = 'prettyprint lang-r'>library(ggplot2)
library(gridExtra)
theme_set(theme_bw())

Pl1 &lt;- ggplot(mds_vor2_com, aes(x=MDS1, y=MDS2)) + geom_point() + 
  geom_path() + geom_text(label = com$Year[com$Bank == &quot;Vor2&quot;]) + 
  ggtitle(&quot;Динамика сообщества&quot;)

Pl2 &lt;- ggplot(mds_vor2_ascam, aes(x=MDS1, y=MDS2)) + geom_point() + 
  geom_path() + geom_text(label = com$Year[com$Bank == &quot;Vor2&quot;]) + 
  ggtitle(&quot;Динамика размерной структуры&quot;)

grid.arrange(Pl1, Pl2)</pre>

</article></slide><slide class=""><hgroup><h2>Градиентная модельная матрица</h2></hgroup><article  id="градиентная-модельная-матрица">

<p>Это матрица Евклидовых расстояний между временными точками.</p>

<pre class = 'prettyprint lang-r'>gradient_model &lt;- vegdist(com$Year[com$Bank == &quot;Vor2&quot;], method=&quot;euclidian&quot;)
gradient_model </pre>

<pre >##     1  2  3  4  5  6  7  8  9 10 11 12 13 14
## 2   1                                       
## 3   2  1                                    
## 4   3  2  1                                 
## 5   4  3  2  1                              
## 6   5  4  3  2  1                           
## 7   6  5  4  3  2  1                        
## 8   7  6  5  4  3  2  1                     
## 9   8  7  6  5  4  3  2  1                  
## 10  9  8  7  6  5  4  3  2  1               
## 11 10  9  8  7  6  5  4  3  2  1            
## 12 11 10  9  8  7  6  5  4  3  2  1         
## 13 12 11 10  9  8  7  6  5  4  3  2  1      
## 14 13 12 11 10  9  8  7  6  5  4  3  2  1   
## 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1</pre>

</article></slide><slide class=""><hgroup><h2>Тестируем гипотезу о наличии градиента</h2></hgroup><article  id="тестируем-гипотезу-о-наличии-градиента">

<p>Протестируем гипотезу о наличии временного градиента с помощью теста Мантела.</p>

<pre class = 'prettyprint lang-r'>dist_vor2_com &lt;- vegdist(vor2_log_com, method = &quot;bray&quot;)
dist_vor2_ascam &lt;- vegdist(vor2_log_ascam, method = &quot;euclidean&quot;)</pre>

<h3>1) Наличие градиента в структуре сообщества</h3>

<pre class = 'prettyprint lang-r'>mantel(dist_vor2_com, gradient_model)</pre>

<pre >## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist_vor2_com, ydis = gradient_model) 
## 
## Mantel statistic r: 0.264 
##       Significance: 0.018 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.160 0.212 0.248 0.295 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Тестируем гипотезу о наличии градиента</h2></hgroup><article  id="тестируем-гипотезу-о-наличии-градиента-1">

<h3>2) Наличие градиента в размерной структуре мидий</h3>

<pre class = 'prettyprint lang-r'>mantel(dist_vor2_ascam, gradient_model)</pre>

<pre >## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist_vor2_ascam, ydis = gradient_model) 
## 
## Mantel statistic r: 0.516 
##       Significance: 0.001 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.167 0.215 0.268 0.301 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Прослеживается ли связь между размерной структурой мидий и структурой сообщества?</h2></hgroup><article  id="прослеживается-ли-связь-между-размерной-структурой-мидий-и-структурой-сообщества">

<h3>Не самое правильное решение</h3>

<pre class = 'prettyprint lang-r'>mantel(dist_vor2_com, dist_vor2_ascam)</pre>

<pre >## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist_vor2_com, ydis = dist_vor2_ascam) 
## 
## Mantel statistic r: 0.521 
##       Significance: 0.01 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.280 0.373 0.452 0.517 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Прослеживается ли связь между размерной структурой мидий и структурой сообщества?</h2></hgroup><article  id="прослеживается-ли-связь-между-размерной-структурой-мидий-и-структурой-сообщества-1">

<h3>Более корректное решение</h3>

<pre class = 'prettyprint lang-r'>mantel.partial(dist_vor2_com, dist_vor2_ascam, gradient_model)</pre>

<pre >## 
## Partial Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel.partial(xdis = dist_vor2_com, ydis = dist_vor2_ascam,      zdis = gradient_model) 
## 
## Mantel statistic r: 0.465 
##       Significance: 0.023 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.292 0.394 0.444 0.502 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Могут быть и более сложные модельные матрицы</h2></hgroup><article  id="могут-быть-и-более-сложные-модельные-матрицы" class="columns-2">

<p>Проверим, нет ли в динамике размерной структуры мидий на банке Vor2 циклических изменений, которые предсказываются некоторыми моделями динамики плотных поселений (Наумов, 2006; Khaitov, Lentsman, 2016).</p>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-36-1.png" width="384" style="display: block; margin: auto;" /></p>

<p>Циклическая модельная матрица.</p>

<pre >##    1 2 3 4 5 6 7 8 9 10 11 12 13 14
## 2  0                               
## 3  1 0                             
## 4  1 1 0                           
## 5  1 1 1 0                         
## 6  2 1 1 1 0                       
## 7  2 2 1 1 1 0                     
## 8  2 2 2 1 1 1 0                   
## 9  2 2 2 2 1 1 1 0                 
## 10 2 2 2 2 2 1 1 1 0               
## 11 2 2 2 2 2 2 1 1 1  0            
## 12 1 2 2 2 2 2 2 1 1  1  0         
## 13 1 1 2 2 2 2 2 2 1  1  1  0      
## 14 1 1 1 2 2 2 2 2 2  1  1  1  0   
## 15 0 1 1 1 2 2 2 2 2  2  1  1  1  0</pre>

</article></slide><slide class=""><hgroup><h2>Выявляется ли циклическая составляющая в динамике размерной структуры?</h2></hgroup><article  id="выявляется-ли-циклическая-составляющая-в-динамике-размерной-структуры">

<pre class = 'prettyprint lang-r'>mantel(dist_vor2_ascam, cycl_model)</pre>

<pre >## 
## Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel(xdis = dist_vor2_ascam, ydis = cycl_model) 
## 
## Mantel statistic r: 0.173 
##       Significance: 0.005 
## 
## Upper quantiles of permutations (null model):
##    90%    95%  97.5%    99% 
## 0.0738 0.0996 0.1236 0.1450 
## Permutation: free
## Number of permutations: 999</pre>

<p>Циклическая составляющая есть, но…</p>

</article></slide><slide class=""><hgroup><h2>Более корректная оценка</h2></hgroup><article  id="более-корректная-оценка">

<pre class = 'prettyprint lang-r'>mantel.partial(dist_vor2_ascam, cycl_model, gradient_model)</pre>

<pre >## 
## Partial Mantel statistic based on Pearson&#39;s product-moment correlation 
## 
## Call:
## mantel.partial(xdis = dist_vor2_ascam, ydis = cycl_model, zdis = gradient_model) 
## 
## Mantel statistic r: -0.137 
##       Significance: 0.94 
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.127 0.155 0.186 0.215 
## Permutation: free
## Number of permutations: 999</pre>

<p>Мы не можем говорить о наличии столь длительного цикла. При данной длине временного ряда нельзя отличить цикл с большим периодом от направленного изменения. Можно обсуждать только циклы с периодом не более половины длины временного ряда.</p>

<!-- ## Модельные матрицы и ANOSIM -->

<!-- При проверке гипотезы о значимости различий между группами можно использовать тест Мантела. В этой ситуации модельная матрица будет содержать 0, если расстояние внутригрупповое, и 1 если расстояние межгрупповое.  -->

<!-- ```{r} -->

<!-- m <- vegdist(as.numeric(com$Bank), method = "euclidean")  -->

<!-- mm <- m -->

<!-- mm[m > 0] <- 1 -->

<!-- mm[m == 0] <- 0 -->

<!-- mantel(vegdist(log_com), mm, method = "pearson") -->

<!-- ``` -->

<!-- Значения теста Мантела будут очень близки к $R_{global}$ -->

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>ANOSIM и SIMPER</h2></hgroup><article  id="anosim-и-simper">

</article></slide><slide class=""><hgroup><h2>Вы сможете</h2></hgroup><article  id="вы-сможете-1">

<ul>
<li>Протестировать гипотезу о различиях между дискретными группами многомерных данных с помощью теста ANOSIM.<br/></li>
<li>Выявить переменные, вносящие наибольший вклад в формирование различий между группами, применив процедуру SIMPER.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Вспомним основы</h2></hgroup><article  id="вспомним-основы" class="columns-2">

<p><img src="images/underwood.png" width="450" height="450" alt="Underwood, 1997"></p>

<p>Этапы работы с гипотезами (из Underwood, 1997):</p>

<ul>
<li><p>Формулировка биологической гипотезы;</p></li>
<li><p>Численное выражение биологической гипотезы (\(H\));</p></li>
<li><p>Формулировка альтернативной гипотезы (\(H_0\) — нулевой гипотезы);</p></li>
<li><p>Тестирование нулевой гипотезы.</p></li>
</ul>

<p>Если \(H_0\) ложна, то признаем, что верна \(H\) и, следовательно, биологическую гипотезу можно рассматривать как истинное утверждение.</p>

<p>Если \(H_0\) истинна, то…</p>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>ANOSIM: Analysis Of Similarity</h2></hgroup><article  id="anosim-analysis-of-similarity">

</article></slide><slide class=""><hgroup><h2>ANOSIM</h2></hgroup><article  id="anosim">

<p>ANOSIM — анализ сходства. Анализ используется для выявления различий в матрицах сходств/различия между группами. Представляет собой специальную форму теста Мантела, впервые был предложен К.Кларком и Р.Грином в 1988 году.</p>

<p>ANOSIM — непараметрический тест, результаты которого можно было бы отразить на ординации nMDS.</p>

</article></slide><slide class=""><hgroup><h2>Пример: Динамика сообществ мидиевых банок</h2></hgroup><article  id="пример-динамика-сообществ-мидиевых-банок-1" class="columns-2 smaller">

<p>Существуют ли различия в сообществах мидиевых банок, сформированных старыми и молодыми мидиями (Khaitov, 2013)?</p>

<p><img src="images/musselbed.png" width="450" height="350" alt="Мидиевая банка"></p>

<p><br> <br> <br></p>

<pre class = 'prettyprint lang-r'>com &lt;- read.csv(&quot;data/mussel_beds.csv&quot;, sep=&#39;;&#39;, header = T)

com$Mussel_size &lt;- factor(com$Mussel_size)

ascam &lt;- read.csv(&quot;data/ASCAM.csv&quot;, sep=&#39;;&#39;, header = T)</pre>

<p><br> <br></p>

<p><code>com</code> — усредненные данные по обилию 12 видов для 3 мидиевых банок (Vor2, Vor4, Vor5).<br/><code>ascam</code> — (averaged size class abundance matrix) средние плотности поселения мидий разных размеров (6] размерных классов).</p>

</article></slide><slide class=""><hgroup><h2>Задание</h2></hgroup><article  id="задание-2">

<ul>
<li>Постройте ординацию всех описаний датасета <code>com</code> (прологарифмированные данные) в осях nMDS на основе матрицы Брея-Куртиса.</li>
<li>Раскрасьте разными цветами точки, относящиеся к двум разным группам: &ldquo;Large-dominated&rdquo; и &ldquo;Small-dominated&rdquo;.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-6">

<pre class = 'prettyprint lang-r'>library(vegan)
library(ggplot2)

log_com &lt;- log(com[,-c(1:3)] + 1)

ord_log_com &lt;- metaMDS(log_com, distance = &quot;bray&quot;, k=2, 
                       autotransform = FALSE, trace = 0)
MDS &lt;- data.frame(ord_log_com$points)</pre>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-7">

<p>Обратите внимание, здесь есть две группы расстояний между точками.</p>

<pre class = 'prettyprint lang-r'>ggplot(MDS, aes(x = MDS1, y = MDS2, fill = com$Mussel_size)) + 
  geom_point(shape = 21, size = 4) + 
  scale_fill_manual(values = c(&quot;red&quot;, &quot;blue&quot;)) + 
  labs(fill = &quot;Mussel size structure type&quot;) + 
  ggtitle(paste(&quot;Stress = &quot;, round(ord_log_com$stress, 3), sep = &quot; &quot;))</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-42-1.png" width="576" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Расстояния между объектами</h2></hgroup><article  id="расстояния-между-объектами" class="columns-2">

<h3>1. Внутригрупповые расстояния</h3>

<img src='images/witnin%20group%20distances.png' title='fig:'/><p class='caption'>Within group distance</p>

<p><br /></p>

<h3>2. Межгрупповые расстояния</h3>

<img src='images/Between%20groups%20distances.png' title='fig:'/><p class='caption'>between group distance</p>

</article></slide><slide class=""><hgroup><h2>Ранги расстояний</h2></hgroup><article  id="ранги-расстояний">

<p>Для работы удобно (но не обязательно!) перейти от исходных расстояний между объектами, к их рангам.</p>

<p>Обозначим внутригрупповые расстояния (ранги), как \(r_w\), а межгрупповые, как \(r_b\).</p>

<p>Вычислим</p>

<ul>
<li>средние значения внутригрупповых рангов расстояний \(R_w\);</li>
<li>средние значения межгрупповых рангов расстояний \(R_b\).</li>
</ul>

</article></slide><slide class=""><hgroup><h2>R-статистика</h2></hgroup><article  id="r-статистика">

<p>На основе полученных значений можно построить статистику (Clarke, 1988, 1993):</p>

<p>\[R_{global} = \frac{R_b-R_w}{n(n-1)/4}\] Эта статистика распределена в интервале -1 &lt; \(R_{global}\) &lt; 1</p>

<p>\(R_{global}\) – оценивает степень разделенности групп в пространстве признаков.</p>

<p>\(R_{global} &gt; 0\) – как минимум есть тенденция к разделению групп.</p>

<p>\(R_{global} \rightarrow 1\) – группы разделяются хорошо.</p>

<p>\(R_{global} \leq 0\) – нет разделения на группы.</p>

<p>Статистическая значимость этой величины оценивается пермутационным методом.</p>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>ANOSIM вручную</h2></hgroup><article  id="anosim-вручную">

</article></slide><slide class=""><hgroup><h2>Ранги расстояний в пространстве признаков</h2></hgroup><article  id="ранги-расстояний-в-пространстве-признаков">

<p><strong>Задание:</strong></p>

<ol>
<li>Вычислите матрицу коэффициентов Брея-Куртиса на основе матрицы <code>log_com</code>.</li>
<li>Разверните полученную матрицу в вектор.</li>
<li>На основе полученного вектора создайте вектор, содержащий ранги расстояний.</li>
</ol>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-8">

<pre class = 'prettyprint lang-r'>dist_com &lt;- vegdist(log_com, method = &quot;bray&quot;)

rank_dist_com &lt;- rank(dist_com)</pre>

</article></slide><slide class=""><hgroup><h2>Внутри- и межгрупповые расстояния</h2></hgroup><article  id="внутри--и-межгрупповые-расстояния">

<p><strong>Задание:</strong></p>

<ol>
<li>Создайте треугольную матрицу <code>dummy_dist</code>, той же размерности, что и матрица <code>dist_com</code>, в которой <code>0</code> будет с стоять в тех ячейках, которые соответствуют межгрупповым расстояниями, а <code>1</code> – внутригрупповым.</li>
</ol>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-9">

<pre class = 'prettyprint lang-r'>dummy_dist &lt;- dist(as.numeric(factor(com$Mussel_size)))

dummy_dist &lt;- ifelse(dummy_dist == 0, 0, 1)</pre>

</article></slide><slide class=""><hgroup><h2>R-статистка</h2></hgroup><article  id="r-статистка">

<p><strong>Задание:</strong></p>

<ol>
<li>Вычислите средние значения рангов внутри- и межгрупповых расстояний.</li>
<li>Вычислите R-статистику.</li>
</ol>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-10">

<pre class = 'prettyprint lang-r'>dists &lt;- data.frame(rank_dist = rank_dist_com,
                    dummy = as.vector(dummy_dist))

library(dplyr)

mean_dists &lt;- dists %&gt;% 
  group_by(dummy) %&gt;% 
  summarize(rank_mean = mean(rank_dist))

n &lt;- nrow(log_com)

R_glob &lt;- (mean_dists$rank_mean[2] - mean_dists$rank_mean[1]) / 
  (n * (n - 1)/4) </pre>

<blockquote>
<p>Вопрос: Каков дальнейший ход процедуры <code>ANOSIM</code>?</p>
</blockquote>

</article></slide><slide class=""><hgroup><h2>Пермутации</h2></hgroup><article  id="пермутации">

<p><strong>Задание:</strong></p>

<ol>
<li>Напишите пользовательскую функцию (пусть она будет называться <code>R_perm</code>), которая пермутировала бы принадлежность каждого объекта к той или иной группе и вычисляла бы значение R-статистики для новой комбинации.</li>
<li>Используя функцию <code>for()</code> вычислите 10000 значений R-статистики и запишите их в вектор.</li>
</ol>

<p>Hint. Весь код для пользовательской функции почти такой же, как ранее писали.</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-11">

<pre class = 'prettyprint lang-r'># функция. Весь код почти такой же, как написали ранее.
R_perm &lt;- function(comm, group){
  require(vegan)
  dist_com &lt;- vegdist(comm)
  rank_dist_com &lt;- rank(dist_com)
  dummy_dist &lt;- dist(sample(as.numeric(group))) #Перемешиваем группы
  dummy_dist &lt;- ifelse(dummy_dist == 0, 0, 1)
  dists &lt;- data.frame(rank = rank_dist_com, 
                      dummy = as.vector(dummy_dist))
  require(dplyr)
  mean_dists &lt;- dists %&gt;% group_by(dummy) %&gt;% 
    summarize(rank_mean = mean(rank))
  n &lt;- nrow(log_com)
  R_p &lt;- (mean_dists$rank_mean[2] - mean_dists$rank_mean[1]) / 
    (n * (n - 1)/4) 
  R_p
} 

R_perms &lt;-  rep(NA, 10000)
for(i in 1:9999) R_perms[i] &lt;- R_perm(comm = log_com, 
                                      group = com$Mussel_size)</pre>

<p>Вопрос: Что надо добавить в вектор <code>R_perms</code>?</p>

</article></slide><slide class=""><hgroup><h2>Распределение пермутационных оценок R-статистики</h2></hgroup><article  id="распределение-пермутационных-оценок-r-статистики">

<p><strong>Задание:</strong></p>

<ol>
<li>Постройте частотную гистограмму, характеризующую распределение пермутационных оценок.</li>
<li>Нанесите на нее полученное значение \(R_{global}\).</li>
<li>Вычислите уровень значимости.</li>
</ol>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-12">

<pre class = 'prettyprint lang-r'>R_perms[10000] &lt;- R_glob

Pl_manual &lt;- ggplot(data.frame(R_perms), aes(x = R_perms)) + 
  geom_histogram(binwidth = 0.01) + 
  geom_vline(xintercept = R_glob, linetype = 2) + xlim(-0.4, 0.4) 

Pl_manual</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-47-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-13">

<p>Вычисляем уровень значимости.</p>

<pre class = 'prettyprint lang-r'>p_level &lt;- mean(R_perms &gt;= R_glob)
p_level</pre>

<pre >## [1] 0.0012</pre>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Процедура ANOSIM в пакете <code>vegan</code></h2></hgroup><article  id="процедура-anosim-в-пакете-vegan">

</article></slide><slide class=""><hgroup><h2>Специализированная функция <code>anosim()</code></h2></hgroup><article  id="специализированная-функция-anosim">

<pre class = 'prettyprint lang-r'>com_anosim &lt;- anosim(log_com, 
           grouping = com$Mussel_size, 
           permutations = 9999, 
           distance = &quot;bray&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Задание</h2></hgroup><article  id="задание-3">

<p>Изучите структуру объекта <code>com_anosim</code> и постройте частотное распределение значений \(R_{global}\), полученных при каждом акте пермутации.</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-14">

<pre class = 'prettyprint lang-r'>anosim_perm &lt;- data.frame(perm = com_anosim$perm)

anosim_perm[(com_anosim$permutations + 1), 1] &lt;- com_anosim$statistic

Pl_prof &lt;- ggplot(anosim_perm, aes(x = perm)) + 
  geom_histogram(binwidth = 0.01, color = &quot;black&quot;, fill = &quot;blue&quot;) + 
  geom_vline(xintercept = com_anosim$statistic, linetype = 2)  +
  xlim(-0.4, 0.4)
Pl_prof</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/r-global-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Сравним результаты ручной и автоматической обработки</h2></hgroup><article  id="сравним-результаты-ручной-и-автоматической-обработки">

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-50-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Результаты процедуры ANOSIM</h2></hgroup><article  id="результаты-процедуры-anosim">

<pre class = 'prettyprint lang-r'>summary(com_anosim)</pre>

<pre >## 
## Call:
## anosim(x = log_com, grouping = com$Mussel_size, permutations = 9999,      distance = &quot;bray&quot;) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.219 
##       Significance: 0.0006 
## 
## Permutation: free
## Number of permutations: 9999
## 
## Upper quantiles of permutations (null model):
##    90%    95%  97.5%    99% 
## 0.0597 0.0822 0.1023 0.1304 
## 
## Dissimilarity ranks between and within classes:
##                 0%   25%   50%   75% 100%   N
## Between          1 301.5 549.0 766.5  946 459
## Large_dominated  4 193.0 360.0 645.0  945 351
## Small_dominated  3 275.0 478.5 683.2  938 136</pre>

</article></slide><slide class=""><hgroup><h2>Ограничения (Assumptions) для применения ANOSIM</h2></hgroup><article  id="ограничения-assumptions-для-применения-anosim">

<h3>1) Внутригрупповые расстояния (ранги) для разных групп должны иметь приблизительно равные медианы и пределы варьирования.</h3>

<p>Для проверки этого допущения надо сравнить распределения внутригрупповых и межгрупповых расстояний (рангов).</p>

<p>Распределение расстояний имеет следующий вид:</p>

<pre class = 'prettyprint lang-r'>plot(com_anosim)</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-52-1.png" width="480" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>ANOSIM позволяет сравнивать одновременно и несколько групп</h2></hgroup><article  id="anosim-позволяет-сравнивать-одновременно-и-несколько-групп">

<p>НО! Есть одно очень важное ограничение:</p>

<h3>2) Попарные сравненения групп можно осуществлять только если было показано, что \(R_{global}\) статистически значимо.</h3>

<p>Если это условие выполнено, то можно проводить попарные сравнения.</p>

<h3>Пример</h3>

<p>Пусть у нас есть три группы объектов: A, B, C.<br/>Можно вычислить \(R_{A vs B}\), \(R_{A vs C}\), \(R_{B vs C}\).</p>

<p>Но при больших объемах выборки даже незначительные различия будут достоверны. Важно обращать внимание не только на оценку статистической значимости, но и на значения R!</p>

<p><strong>Важно!</strong> При множественных сравнениях придется вводить поправку Бонферрони.</p>

<p>NB! Для сравнения нескольких групп многомерных объектов, есть более мощное средство — <strong>PERMANOVA</strong>.</p>

</article></slide><slide class=""><hgroup><h2>Задание</h2></hgroup><article  id="задание-4">

<ul>
<li>Постройте ординацию в осях nMDS, раскрасив точки в разные цвета в зависимости от номера мидиевой банки (переменная Bank);</li>
<li>Проверьте гипотезу о различиях в структуре сообществ на разных банках;</li>
<li>Проверьте условия применимости ANOSIM;</li>
<li>Проведите попарное сравнение всех банок.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-15">

<h3>График ординации</h3>

<pre class = 'prettyprint lang-r'>ggplot(MDS, aes(x = MDS1, y = MDS2, fill = com$Bank)) + 
  geom_point(shape = 21, size = 4) + 
  scale_fill_manual(values = c(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;)) + 
  labs(fill = &quot;Mussel beds&quot;) + 
  ggtitle(paste(&quot;Stress = &quot;, round(ord_log_com$stress, 3), 
                sep = &quot; &quot;))</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-53-1.png" width="480" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-16">

<h3>Проверка гипотезы о различиях в структуре сообществ на разных банках</h3>

<pre class = 'prettyprint lang-r'>bed_anosim &lt;- anosim(log_com, grouping = com$Bank, 
                     permutations = 999, distance = &quot;bray&quot;)
bed_anosim</pre>

<pre >## 
## Call:
## anosim(x = log_com, grouping = com$Bank, permutations = 999,      distance = &quot;bray&quot;) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.44 
##       Significance: 0.001 
## 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-17">

<h3>Условия применимости</h3>

<pre class = 'prettyprint lang-r'>plot(bed_anosim)</pre>

<p><img src="03_Mantel_correlation-based_methods_ANOSIM_SIMPER_files/figure-html/unnamed-chunk-55-1.png" width="672" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-18">

<h3>Попарные сравнения Vor2 vs Vor4</h3>

<pre class = 'prettyprint lang-r'># Vor2 vs Vor4
anosim(log_com[com$Bank %in% c(&quot;Vor2&quot;, &quot;Vor4&quot;),], 
    grouping = com$Bank[com$Bank %in% c(&quot;Vor2&quot;, &quot;Vor4&quot;)])</pre>

<pre >## 
## Call:
## anosim(x = log_com[com$Bank %in% c(&quot;Vor2&quot;, &quot;Vor4&quot;), ], grouping = com$Bank[com$Bank %in%      c(&quot;Vor2&quot;, &quot;Vor4&quot;)]) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.588 
##       Significance: 0.001 
## 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Попарные сравнения Vor2 vs Vor5</h2></hgroup><article  id="попарные-сравнения-vor2-vs-vor5">

<pre class = 'prettyprint lang-r'># Vor2 vs Vor5
anosim(log_com[com$Bank %in% c(&quot;Vor2&quot;, &quot;Vor5&quot;),], 
       grouping = com$Bank[com$Bank %in% c(&quot;Vor2&quot;, &quot;Vor5&quot;)])</pre>

<pre >## 
## Call:
## anosim(x = log_com[com$Bank %in% c(&quot;Vor2&quot;, &quot;Vor5&quot;), ], grouping = com$Bank[com$Bank %in%      c(&quot;Vor2&quot;, &quot;Vor5&quot;)]) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.309 
##       Significance: 0.001 
## 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Попарные сравнения Vor4 vs Vor5</h2></hgroup><article  id="попарные-сравнения-vor4-vs-vor5">

<pre class = 'prettyprint lang-r'># Vor4 vs Vor5
anosim(log_com [com$Bank %in% c(&quot;Vor4&quot;, &quot;Vor5&quot;),], 
       grouping = com$Bank[com$Bank %in% c(&quot;Vor4&quot;, &quot;Vor5&quot;)])</pre>

<pre >## 
## Call:
## anosim(x = log_com[com$Bank %in% c(&quot;Vor4&quot;, &quot;Vor5&quot;), ], grouping = com$Bank[com$Bank %in%      c(&quot;Vor4&quot;, &quot;Vor5&quot;)]) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.426 
##       Significance: 0.001 
## 
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Проблема малых выборок</h2></hgroup><article  id="проблема-малых-выборок">

<p>Мощность ANOSIM невелика.</p>

<p>При малых выборках пермутационная оценка уровня значимости может не выявить достоверных различий, даже при очень высоком значении R.</p>

</article></slide><slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>SIMPER: Similarity Percentages</h2></hgroup><article  id="simper-similarity-percentages">

</article></slide><slide class=""><hgroup><h2>SIMPER: анализ процентного сходства</h2></hgroup><article  id="simper-анализ-процентного-сходства">

<p>Данный анализ стремится оценить средний процентный вклад отдельных переменных в значения, полученные в матрице расстояний Брея-Куртиса.</p>

<p>Введён Кларком в 1993, несмотря на название исследует скорее различия, чем сходства между объектами.</p>

<p>В результате выдаёт список видов, которые вносят наибольший вклад, для каждой из сравниваемых групп.</p>

</article></slide><slide class=""><hgroup><h2>Какие признаки зависимой матрицы вносят наибольший вклад в формирование различий между группами?</h2></hgroup><article  id="какие-признаки-зависимой-матрицы-вносят-наибольший-вклад-в-формирование-различий-между-группами" class="smaller">

<pre class = 'prettyprint lang-r'>log_com_simper &lt;- simper(log_com, group = com$Mussel_size, 
                         permutations = 999)
summary(log_com_simper)</pre>

<pre >## 
## Contrast: Large_dominated_Small_dominated 
## 
##                        average      sd   ratio     ava     avb cumsum     p    
## Polydora_quadrilobata  0.04190 0.02941 1.42300 0.86000 2.43000   0.18 0.003 ** 
## Hydrobia_ulvae         0.02600 0.01812 1.43400 3.26000 2.83000   0.29 0.889    
## Skeneopsis_planorbis   0.02340 0.01722 1.36100 0.38000 1.28000   0.39 0.001 ***
## Fabricia_sabella       0.02230 0.01799 1.24200 0.92000 1.31000   0.48 0.326    
## Cricotopus_vitripennis 0.02100 0.01512 1.38700 1.69000 2.22000   0.57 0.130    
## Onoba_aculeus          0.01880 0.01319 1.42500 1.07000 1.57000   0.65 0.021 *  
## Nemertini              0.01720 0.01417 1.21200 2.16000 2.51000   0.72 0.158    
## Macoma_balthica        0.01540 0.01299 1.18900 2.61000 2.68000   0.79 0.643    
## Littorina_saxatilis    0.01540 0.01003 1.53700 2.04000 1.69000   0.85 0.004 ** 
## Filamentous_algae      0.01500 0.01145 1.31500 0.83000 0.63000   0.92 0.950    
## Gammarus_sp.           0.01140 0.00892 1.28400 1.77000 1.92000   0.96 0.885    
## Tubificoides_benedeni  0.00820 0.00613 1.33900 4.86000 4.75000   1.00 0.927    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Оценка вклада в формирование различий</h2></hgroup><article  id="оценка-вклада-в-формирование-различий">

<p>\[Contr_{ijk} = \frac{|{y_{ij}-y_{ik}}|}{\sum\limits_{i=1}^{S}{(y_{ij}+y_{ik})}}\]</p>

<p>\(y_{i,j}-y_{i,k}\) — разность значений \(i\)-той переменной (вида) в объектах (пробах) \(j\) и \(k\). \(S\) — количество всех видов.</p>

<p>Итоговая статистика вычисляется как сумма вклада каждого отдельного вида:</p>

<p>\[d_{jk} = \sum\limits_{i = 1}^{S}d_{ijk}\]</p>

</article></slide><slide class=""><hgroup><h2>Результаты SIMPER</h2></hgroup><article  id="результаты-simper">

<p>\(average\) –– вклад, который признак вносит в различия;</p>

<p>\(ava\) и \(avb\) –– среднее обилие в первой и второй группе, соответственно;</p>

<p>\(sd\) –– стандартное отклонение \(average\);</p>

<p>\(ratio\) — \(average/sd\); отношение вклада к отклонению. Характеризует дискриминирующую силу переменной;</p>

<p>\(cumsum\) –– накопленная степень различий.</p>

</article></slide><slide class=""><hgroup><h2>Задание</h2></hgroup><article  id="задание-5">

<p>Выявите виды, отвечающие за различия в сообществах разных банок</p>

</article></slide><slide class=""><hgroup><h2>Решение</h2></hgroup><article  id="решение-19">

<pre class = 'prettyprint lang-r'>summary(simper(log_com, group = com$Bank, permutations = 999))</pre>

<pre >## 
## Contrast: Vor2_Vor4 
## 
##                        average      sd   ratio     ava     avb cumsum     p    
## Polydora_quadrilobata  0.04660 0.02795 1.66800 0.67000 2.80000   0.18 0.001 ***
## Hydrobia_ulvae         0.03250 0.01559 2.08200 3.68000 2.46000   0.30 0.003 ** 
## Skeneopsis_planorbis   0.02820 0.01816 1.55300 0.05000 1.46000   0.41 0.001 ***
## Fabricia_sabella       0.02230 0.01699 1.31200 1.55000 1.09000   0.50 0.474    
## Nemertini              0.02100 0.01389 1.51400 1.92000 2.53000   0.58 0.004 ** 
## Filamentous_algae      0.01950 0.01314 1.48100 1.19000 0.42000   0.66 0.002 ** 
## Onoba_aculeus          0.01840 0.01375 1.34200 0.86000 1.42000   0.73 0.207    
## Littorina_saxatilis    0.01740 0.01013 1.71900 2.18000 1.36000   0.80 0.001 ***
## Cricotopus_vitripennis 0.01700 0.01182 1.44100 2.07000 2.34000   0.86 0.989    
## Macoma_balthica        0.01430 0.01224 1.16500 2.74000 2.77000   0.92 0.823    
## Gammarus_sp.           0.01220 0.00936 1.30200 1.83000 1.99000   0.96 0.387    
## Tubificoides_benedeni  0.00950 0.00664 1.42900 5.03000 4.71000   1.00 0.073 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Contrast: Vor2_Vor5 
## 
##                        average      sd   ratio     ava     avb cumsum     p   
## Hydrobia_ulvae         0.02890 0.02376 1.21600 3.68000 3.14000   0.13 0.174   
## Fabricia_sabella       0.02754 0.01847 1.49100 1.55000 0.53000   0.26 0.006 **
## Polydora_quadrilobata  0.02197 0.02301 0.95500 0.67000 0.89000   0.36 1.000   
## Cricotopus_vitripennis 0.02168 0.01407 1.54100 2.07000 1.22000   0.46 0.198   
## Onoba_aculeus          0.01916 0.01373 1.39600 0.86000 1.52000   0.55 0.096 . 
## Filamentous_algae      0.01804 0.01220 1.47900 1.19000 0.63000   0.63 0.027 * 
## Macoma_balthica        0.01679 0.01317 1.27400 2.74000 2.38000   0.71 0.251   
## Nemertini              0.01653 0.01208 1.36800 1.92000 2.44000   0.79 0.547   
## Skeneopsis_planorbis   0.01380 0.01094 1.26100 0.05000 0.67000   0.85 0.997   
## Gammarus_sp.           0.01227 0.00893 1.37400 1.83000 1.64000   0.91 0.355   
## Littorina_saxatilis    0.01019 0.00712 1.43000 2.18000 2.20000   0.95 1.000   
## Tubificoides_benedeni  0.01009 0.00690 1.46100 5.03000 4.70000   1.00 0.011 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Contrast: Vor4_Vor5 
## 
##                        average      sd   ratio     ava     avb cumsum     p    
## Polydora_quadrilobata  0.04700 0.02844 1.65300 2.80000 0.89000   0.20 0.001 ***
## Cricotopus_vitripennis 0.02800 0.01679 1.66600 2.34000 1.22000   0.31 0.001 ***
## Hydrobia_ulvae         0.02460 0.01588 1.55200 2.46000 3.14000   0.42 0.853    
## Skeneopsis_planorbis   0.02370 0.01545 1.53600 1.46000 0.67000   0.51 0.003 ** 
## Fabricia_sabella       0.02010 0.01698 1.18300 1.09000 0.53000   0.60 0.840    
## Littorina_saxatilis    0.01870 0.01087 1.72400 1.36000 2.20000   0.68 0.001 ***
## Onoba_aculeus          0.01640 0.01182 1.38800 1.42000 1.52000   0.74 0.805    
## Macoma_balthica        0.01630 0.01375 1.18400 2.77000 2.38000   0.81 0.387    
## Nemertini              0.01430 0.01378 1.03900 2.53000 2.44000   0.87 0.885    
## Filamentous_algae      0.01230 0.00855 1.43800 0.42000 0.63000   0.92 0.996    
## Gammarus_sp.           0.01150 0.00931 1.23900 1.99000 1.64000   0.97 0.632    
## Tubificoides_benedeni  0.00680 0.00494 1.37000 4.71000 4.70000   1.00 0.997    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</pre>

</article></slide><slide class=""><hgroup><h2>Summary</h2></hgroup><article  id="summary">

<ul>
<li>Степень сопряженности двух наборов признаков можно оценивать с помощью теста Мантела.</li>
<li>Оценка достоверности теста Мантела и корреляций с признаками, вычисленными в процедуре <code>envfit()</code> проводится пермутационным методом</li>
<li>С помощью процедуры <code>BIO-ENV</code> можно выявить набор переменных в матрице-предикторе, которые обеспечивают наибольшее сходство с зависимой матрицей.</li>
<li>ANOSIM — простейший вариант сравнения нескольких групп объектов, охарактеризованных по многим признакам.</li>
<li>С помощью процедуры SIMPER можно оценить вклад отдельных переменных в формирование различий между группами.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Другое программное обеспечение</h2></hgroup><article  id="другое-программное-обеспечение">

<p>PRIMER 6.</p>

<p>Здесь реализована расширенная процедура <code>BEST</code>.<br/>Она позволяет проводить не только полный перебор всех переменных в матрице-предикторе (Bio-Env), но и оптимизировать эту процедуру (BVStep). Кроме того, есть возможность оценивать достоверность результатов анализа. Но работает так же медленно.</p>

</article></slide><slide class=""><hgroup><h2>Что почитать</h2></hgroup><article  id="что-почитать">

<ul>
<li>Oksanen, J., 2011. Multivariate analysis of ecological communities in R: vegan tutorial. R package version 2–0.</li>
<li>Clarke, K. R &amp; Ainsworth, M. 1993. A method of linking multivariate community structure to environmental variables. Marine Ecology Progress Series, 92, 205–219.</li>
<li>Clarke, K. R., Gorley R. N. (2006) PRIMER v6: User Manual/Tutorial. PRIMER-E, Plymouth.</li>
<li>Legendre P., Legendre L. (2012) Numerical ecology. Second english edition. Elsevier, Amsterdam. (В этом издании приводятся ссылки на реализацию методов в R)</li>
</ul></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>

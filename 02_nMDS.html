<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Неметрическое многомерное шкалирование, envfit, ordisurf</title>
    <meta charset="utf-8" />
    <meta name="author" content="Марина Варфоломеева" />
    <meta name="author" content="Вадим Хайтов" />
    <script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
    <link href="site_libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="site_libs/remark-css-0.0.1/tamu-fonts.css" rel="stylesheet" />
    <link href="site_libs/remark-css-0.0.1/ninjutsu.css" rel="stylesheet" />
    <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <!-- https://github.com/fnaufel/xaringan-smartify-->
    <script
    			  src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    			  integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
    			  crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/fnaufel/xaringan-smartify/smartify.min.js"></script>
    <link rel="stylesheet" href="assets/xaringan.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: top, center, inverse, title-slide

.title[
# Неметрическое многомерное шкалирование, envfit, ordisurf
]
.subtitle[
## Анализ и визуализация многомерных данных с использованием R
]
.author[
### Марина Варфоломеева
]
.author[
### Вадим Хайтов
]

---


- Неметрическое многомерное шкалирование
- Как работает неметрическое многомерное шкалирование
- Оценка качества подгонки ординации
- Трактовка результатов ординации

### Вы сможете

- Построить диаграмму nMDS.
- Охарактеризовать качество ординации с помощью величины стресса.
- Сравнить результаты нескольких ординаций.



---

class: middle, center, inverse

# Проблема изображения многомерных данных

---

## Облако точек в многомерном пространстве

Когда признаков много, можно представить все объекты как облако точек в многомерном пространстве.

![](./images/Migration-DonMcCullough-Flickr.jpg)

Migration by Don McCullough
on [Flickr](https://flic.kr/p/fEFhCj)

---

## Для изображения N объектов в идеале нужно N-1 измерений

- 2 объекта = 1D прямая
- 3 объекта = 2D плоскость
- 4 объекта = 3D объем
- ...
- N объектов = (N-1)-мерное пространство

---

## Многомерное пространство сложно изобразить. &lt;br/&gt; Есть два пути:

- Выбрать наиболее информативную проекцию (не все видно).
- Сохранить отношения между объектами (придется исказить расстояния).

&lt;img src="images/BlackShadows-FerranJorda-Flickr.jpg" alt="Ежик в тумане" height=400px&gt;

.small[
black shadows for a white horses / les negres ombres dels cavalls blancs by  Ferran Jordà
on [Flickr](https://flic.kr/p/9XJxiL)
]

---

## Неметрическое многомерное шкалирование

__Nonmetric Multidimensional Scaling__, __nMDS__ (Shepard 1962, 1966, Kruskal 1964a, b)

Метод визуализации отношений между объектами в пространстве с небольшим числом измерений (обычно 2).

Исходные данные --- матрица расстояний между объектами в многомерном пространстве.

nMDS ординация старается сохранить отношения между объектами.

---

## Карта пригородов Санкт-Петербурга



![](02_nMDS_files/figure-html/gg-spb-1.png)&lt;!-- --&gt;

---

## Расстояния по автодорогам

&lt;div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; "&gt;&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"&gt; name &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Всеволожск &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Гатчина &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Зеленогорск &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Красное Село &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Кронштадт &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Павловск &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Парголово &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Петергоф &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Пушкин &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Санкт-Петербург &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Сертолово &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Сестрорецк &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Стрельна &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; Шлиссельбург &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 73 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 97 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 76 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 97 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 81 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 87 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 106 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 81 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 76 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 105 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 87 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 73 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 81 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 58 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 93 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 106 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 105 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 81 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 58 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 93 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;&lt;/div&gt;

Расстояния по автодорогам не совсем "евклидовы": например, из Кронштадта до Санкт-Петербурга нельзя добраться по прямой.

---

## Обычная проекция исходного пространства на плоскость неудачна

.pull-left[

Карта&lt;br/&gt;&lt;br/&gt;

![](02_nMDS_files/figure-html/gg-spb-1.png)&lt;!-- --&gt;
]

.pull-right[

Проекция при помощи анализа главных координат (PCoA)

![](02_nMDS_files/figure-html/pcoa-spb-1.png)&lt;!-- --&gt;
]

--

- Карта неудачна: Стрельна, Красное Село и Гатчина сливаются вместе, хотя они не рядом.

---

## Можно восстановить карту, сохраняя ранги расстояний между объектами

.pull-left[

Карта

![](02_nMDS_files/figure-html/gg-spb-1.png)&lt;!-- --&gt;
]

.pull-right[

Ординация nMDS

![](02_nMDS_files/figure-html/ord-spb-1.png)&lt;!-- --&gt;
]

--

- Что странного в этой карте?

---

## Важные свойства nMDS-ординации

--

1. __Сохраняется ранг расстояний между объектами__ (похожие располагаются близко, непохожие --- далеко.  
Если объект А похож на B, больше чем на C, то и на ординации он, скорее всего, окажется ближе к B, чем к C).

--

2. __Имеет смысл только взаиморасположение объектов друг относительно друга__.  
Суть ординации не изменится, если решение 
  - вращать, 
  - перемещать, 
  - зеркально отражать

--

3. __Численные значения координат точек в ординации лишены смысла__.  
Их вообще можно не приводить на итоговой ординации.

---

class: middle, center, inverse

# Как работает nMDS

---

## Наблюдаемые различия и ожидаемые расстояния

Взаиморасположение точек на плоскости подобно взаиморасположению точек в многомерном пространстве признаков, но значения не полностью совпадают.

&lt;div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:450px; overflow-x: scroll; width:100%; "&gt;&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"&gt; item1 &lt;/th&gt;
   &lt;th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;"&gt; item2 &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; observed &lt;/th&gt;
   &lt;th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"&gt; nmds &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.09 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13.67 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.97 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.97 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21.47 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.15 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 27.30 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.55 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23.50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25.23 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25.05 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24.25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.27 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21.16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28.38 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.91 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35.05 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 32.23 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30.32 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.45 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.42 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.38 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38.72 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38.70 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30.55 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39.27 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36.71 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.95 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.19 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.78 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41.27 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.82 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 40.29 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51.70 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53.68 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.93 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.75 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Санкт-Петербург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59.50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52.82 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51.84 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55.35 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 53.18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.96 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50.17 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 58 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.28 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49.35 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57.61 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59.81 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55.36 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 56.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61.41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52.49 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.78 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61.35 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.55 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55.09 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 58.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.99 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Парголово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72.39 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 68.27 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.03 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.74 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.92 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65.64 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.26 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77.75 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Всеволожск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 73 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72.14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.75 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 69.97 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 76 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75.29 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 78.28 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сертолово &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80.05 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.81 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Стрельна &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 78.58 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Красное Село &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 81 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 84.63 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Петергоф &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 81 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 91.04 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82.78 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Пушкин &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 86.02 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Павловск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 87 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 92.81 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Сестрорецк &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 93 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 88.41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Гатчина &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 97 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 106.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Кронштадт &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 105 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 102.03 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Зеленогорск &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Шлиссельбург &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 106 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 102.34 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;&lt;/div&gt;

---

## Диаграмма Шепарда

__Диаграмма Шепарда__ --- график зависимости расстояний между точками на ординации и соответствующих им значений коэффициентов различия в исходном пространстве.

.pull-left[

![](02_nMDS_files/figure-html/fig-shep-1.png)&lt;!-- --&gt;

]

.pull-right[

- По оси X --- значения коэффициентов различий `\(D_{h,i}\)`, ранжированные в порядке возрастания
- По оси Y --- значения расстояний на плоскости ординации --- `\(d_{h,i}\)`
]

В идеале, ранги расстояний между точками  `\(d_{h,i}\)` на хорошей ординации nMDS должны совпадать с рангами коэффициентов различия `\(D_{h,i}\)` в исходном многомерном пространстве.


---

## Интерпретация диаграммы Шепарда

Форма и расположение облака точек на диаграмме Шепарда позволяет судить о качестве ординации.

.pull-left[

![](./images/shepard-plot-interpretation.png)
]

.pull-right[

- A --- ординация объясняет большую часть исходной изменчивости
- В --- ординация объясняет небольшую часть изменчивости, но относительное расположение точек сохранено
- С --- относительное расположение точек плохо соответствует исходному

]

---

## Диаграмма Шепарда

В идеале, большим расстояниям в исходном пространстве должны соответствовать большие расстояния на ординации, а меньшим --- меньшие (т.е. должны сохраняться ранги расстояний).

.pull-left[

![](02_nMDS_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

]

.pull-right[

Красная линия --- предсказанные монотонной регрессией значения расстояний на ординации --- монотонно возрастает.

]

---

## Монотонная регрессия

__Монотонная регрессия__ минимизирует сумму квадратов отклонений значений координат на ординации от значений в исходном многомерном пространстве, сохраняя монотонные отношения между ними.

Алгоритм подбора монотонной регрессии называется   Pool-Adjacent-Violator-Algorithm (PAVA)

![](02_nMDS_files/figure-html/isoreg-ani-.gif)&lt;!-- --&gt;


---

## Стресс --- мера качества ординации

__Стресс (Stress)__ показывает, насколько соответствуют друг другу взаиморасположение точек на плоскости ординации и в исходном многомерном пространстве признаков.

Стресс 1 (Stress(1), Kruskal, 1964a) --- это корень из суммы квадратов остатков монотонной регрессии, отнесенной к сумме квадратов всех коэффициентов различия в исходной матрице.

.pull-left[

![](02_nMDS_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

]

.pull-right[

`$$Stress(1) = \sqrt{\frac{\sum_{h &lt; i}{(d_{h,i} - \hat d_{h,i})^2}}{\sum_{h &lt; i}{d_{{h,i}}^2}}}$$`

- `\(d\)` --- наблюдаемое значение коэффициента различия между двумя точками
- `\(\hat d\)` --- значение, предсказанное монотонной регрессией

Хорошо, когда `\(Stress(1) &lt; 0.2\)`

]

---

## Алгоритм nMDS

&lt;img src="images/ezhik.jpg" alt="Ежик в тумане" width=280px&gt;
.small[
Марка СССР Ёжик в тумане (1988, ЦФА №5919). [Википедия](https://ru.wikipedia.org/wiki/%D0%A4%D0%B0%D0%B9%D0%BB:1988_CPA_5919.jpg)
]

--

1. Выбираем _a priori_ число измерений _k_ для финального решения (число осей).

--

2. Вычисляем матрицу коэффициентов различия между объектами.

--

3. Вначале размещаем объекты в пространстве _k_ осей случайно (или PCoA).

--

4. Вычисляем матрицу расстояний между точками в пространстве ординации.

--

5. Вычисляем стресс.

--

6. Сдвигаем точки, чтобы минимизировать стресс (метод _steepest descent_).

--

7. Повторяем шаги 3-6 многократно, чтобы избежать локальных минимумов.

--

8. Обычно финальную ординацию поворачивают при помощи PCA, чтобы вдоль оси X было максимальное варьирование.



---

## Преимущества и ограничения nMDS

--

.content-box-green[

### Преимущества

- Неметрический (ранговый) метод, подходит для большинства типов данных.
- Можно использовать любые меры различия подходящие для данных, например
  - коэф.Брея-Куртиса для численностей
  - коэф. Жаккара для данных присутствия-отсутствия  
  и т.п.
]

--

.content-box-red[

### Ограничения

- nMDS --- метод визуализации данных, а не метод анализа (см. напр. perMANOVA)
- Нужно осознанно выбирать способ трансформации данных и коэффициент различия исходя из того, какие именно свойства отношений между объектами должны быть визуализированы
- Выбранное число измерений решения влияет на результат
]

---

class: middle, center, inverse

# Пример: Симбионты мидий

---

## Пример: Симбионты мидий

.pull-left[
[Krapivin et al. 2018](https://doi.org/10.3354/dao03259) 

Данные можно скачать [с сайта Pangaea](https://doi.pangaea.de/10.1594/PANGAEA.870537?format=textfile) ([Krapivin 2017](https://doi.org/10.1594/PANGAEA.870537))
]

.pull-right[
&lt;img src="images/Krapivin et al.2018.png" width="500"&gt;
]

&lt;a title="Andreas Trepte, CC BY-SA 2.5 &amp;lt;https://creativecommons.org/licenses/by-sa/2.5&amp;gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Blue_mussel_Mytilus_edulis.jpg"&gt;&lt;img width="600" alt="Blue mussel Mytilus edulis" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/Blue_mussel_Mytilus_edulis.jpg/512px-Blue_mussel_Mytilus_edulis.jpg"&gt;&lt;/a&gt;
.small[
Andreas Trepte, [CC BY-SA 2.5](https://creativecommons.org/licenses/by-sa/2.5), via Wikimedia Commons
]

---

## Открываем данные


```r
dat &lt;- read.delim("data/Krapivin_2017_Medulis-symb.tab", skip = 36, 
                  stringsAsFactors = TRUE)
str(dat)
```

```
## 'data.frame':	548 obs. of  23 variables:
##  $ Event                 : Factor w/ 3 levels "Gorelyi_Isl",..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ Date.Time             : Factor w/ 1 level "2013-07": 1 1 1 1 1 1 1 1 1 1 ...
##  $ Ord.No                : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Area                  : Factor w/ 3 levels "B Solovkecki Isl",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Site                  : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ Zone                  : Factor w/ 3 levels "down","middle",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Comment               : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ M..edulis.L.shell..mm.: num  31.2 41.1 46.4 40 34.5 47.6 34.3 49.6 49.8 30 ...
##  $ M..edulis.age..a.     : num  1 2 2 3 4 3 2 4 3 1 ...
##  $ Urastoma.spp.....     : int  26 16 19 11 14 16 10 4 11 0 ...
##  $ Renicola.spp.....     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Himasthla.spp.....    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Metacercaria....      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Gymnophallus.spp..... : int  0 0 0 0 0 0 0 0 4 0 ...
##  $ Bucephalidae....      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Alg....               : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Nematoda....          : int  1 1 0 0 0 0 0 0 0 0 ...
##  $ Microsetella....      : int  0 0 0 0 0 2 0 0 0 0 ...
##  $ Copepoda....          : int  0 0 0 0 0 1 0 0 0 0 ...
##  $ Chironomidae....      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Halacaridae....       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Jaera.spp.....        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Ostrac....            : int  0 0 0 0 0 0 0 0 0 0 ...
```

---

## Приводим в порядок названия переменных


```r
colnames(dat) # Было
```

```
##  [1] "Event"                  "Date.Time"              "Ord.No"                
##  [4] "Area"                   "Site"                   "Zone"                  
##  [7] "Comment"                "M..edulis.L.shell..mm." "M..edulis.age..a."     
## [10] "Urastoma.spp....."      "Renicola.spp....."      "Himasthla.spp....."    
## [13] "Metacercaria...."       "Gymnophallus.spp....."  "Bucephalidae...."      
## [16] "Alg...."                "Nematoda...."           "Microsetella...."      
## [19] "Copepoda...."           "Chironomidae...."       "Halacaridae...."       
## [22] "Jaera.spp....."         "Ostrac...."
```

```r
colnames(dat) &lt;- gsub("[.]", replacement = "", colnames(dat))
dat &lt;- rename(dat, L = "MedulisLshellmm", Age = "Medulisagea")

colnames(dat) # Стало
```

```
##  [1] "Event"           "DateTime"        "OrdNo"           "Area"           
##  [5] "Site"            "Zone"            "Comment"         "L"              
##  [9] "Age"             "Urastomaspp"     "Renicolaspp"     "Himasthlaspp"   
## [13] "Metacercaria"    "Gymnophallusspp" "Bucephalidae"    "Alg"            
## [17] "Nematoda"        "Microsetella"    "Copepoda"        "Chironomidae"   
## [21] "Halacaridae"     "Jaeraspp"        "Ostrac"
```

---

## Приводим в порядок данные


```r
# Делаем сайт фактором
dat$Site &lt;- factor(dat$Site, levels = c(2, 3, 1), labels = c("G","L","S"))

# Сливаем редкие виды в одну категорию
f_remove &lt;- c("Nematoda", "Microsetella", "Copepoda", "Chironomidae", 
              "Halacaridae", "Jaeraspp", "Ostrac")
dat$Other &lt;- rowSums(dat[, f_remove])

# Суммарная численность симбионтов
f_sp &lt;- c("Urastomaspp", "Renicolaspp", "Himasthlaspp", "Metacercaria", 
          "Gymnophallusspp", "Alg", "Other")
dat$Total  &lt;- rowSums(dat[, f_sp])

# Данные для анализа
# Только мидии с симбионтами и возрастом от 3 до 8 лет 
dat &lt;- dat[dat$Total != 0 &amp; dat$Age %in% 3:8, ]
spec &lt;- dat[, f_sp]                         # виды-симбионты
env &lt;- dat[, c("Zone", "Site", "L", "Age")] # свойства мидий-хозяев
```

---

class: middle, center, inverse

# Ординация сообществ симбионтов в мидиях

---

## Задание 1

Постройте ординацию мидий по обилию разных видов-симбионтов с использованием коэффициента различия Брея-Куртиса.
Следите, чтобы алгоритму удалось найти финальное решение. Если необходимо, настройте вызов `metaMDS()`

Вычислите стресс для получившейся ординации.

Нарисуйте простейший график ординации.

```
set.seed(31987)
ord_mus &lt;- 
```

---

## Решение

.scroll-box-20[


```r
set.seed(31987)
ord_mus &lt;- metaMDS(spec, dist = "bray")
```

```
## Square root transformation
## Wisconsin double standardization
## Run 0 stress 0.132 
## Run 1 stress 0.14 
## Run 2 stress 0.131 
## ... New best solution
## ... Procrustes: rmse 0.00913  max resid 0.0904 
## Run 3 stress 0.131 
## ... New best solution
## ... Procrustes: rmse 0.013  max resid 0.0893 
## Run 4 stress 0.134 
## Run 5 stress 0.133 
## Run 6 stress 0.142 
## Run 7 stress 0.131 
## ... New best solution
## ... Procrustes: rmse 0.0104  max resid 0.0921 
## Run 8 stress 0.143 
## Run 9 stress 0.133 
## Run 10 stress 0.135 
## Run 11 stress 0.131 
## Run 12 stress 0.14 
## Run 13 stress 0.13 
## ... New best solution
## ... Procrustes: rmse 0.00904  max resid 0.0728 
## Run 14 stress 0.131 
## Run 15 stress 0.133 
## Run 16 stress 0.132 
## Run 17 stress 0.142 
## Run 18 stress 0.134 
## Run 19 stress 0.132 
## Run 20 stress 0.131 
## *** Best solution was not repeated -- monoMDS stopping criteria:
##     10: stress ratio &gt; sratmax
##     10: scale factor of the gradient &lt; sfgrmin
```

]

Все ли в порядке с этими результатами?

---

## Решение


```r
set.seed(31987)
ord_mus &lt;- metaMDS(spec, dist = "bray")
```

--

.content-box-purple[

__Внимание!__
По-умолчанию metaMDS() пытается подобрать оптимальную трансформацию, подходящую для анализа сообществ. В данном случае --- извлекает корень и делает двойную висконсинскую стандартизацию.

]

```
* ## Square root transformation
* ## Wisconsin double standardization
  ## Run 0 stress 0.132 
  ## Run 1 stress 0.151 
  ## Run 2 stress 0.13 
  ## ... New best solution
  ## ... Procrustes: rmse 0.0161  max resid 0.0895 
  ## Run 3 stress 0.14 
  ...
```

--

.content-box-red[

Эта модель не сходится!

]

```
  ...
  ## Run 19 stress 0.133 
  ## Run 20 stress 0.138 
* ## *** No convergence -- monoMDS stopping criteria:
  ##     12: stress ratio &gt; sratmax
  ##      8: scale factor of the gradient &lt; sfgrmin
```

---

## Решение

После отключения автоматического подбора трансформации данных и увеличения количества попыток удается найти решение.

.scroll-box-20[


```r
set.seed(31987)
ord_mus &lt;- metaMDS(spec, dist = "bray", autotransform = FALSE)
```

```
## Run 0 stress 0.141 
## Run 1 stress 0.154 
## Run 2 stress 0.151 
## Run 3 stress 0.147 
## Run 4 stress 0.141 
## ... New best solution
## ... Procrustes: rmse 0.00149  max resid 0.0125 
## Run 5 stress 0.141 
## ... Procrustes: rmse 0.00267  max resid 0.0248 
## Run 6 stress 0.153 
## Run 7 stress 0.144 
## Run 8 stress 0.143 
## Run 9 stress 0.141 
## ... Procrustes: rmse 0.000246  max resid 0.00481 
## ... Similar to previous best
## Run 10 stress 0.146 
## Run 11 stress 0.141 
## ... Procrustes: rmse 0.00147  max resid 0.0211 
## Run 12 stress 0.148 
## Run 13 stress 0.144 
## Run 14 stress 0.145 
## Run 15 stress 0.146 
## Run 16 stress 0.143 
## Run 17 stress 0.144 
## Run 18 stress 0.145 
## Run 19 stress 0.141 
## ... Procrustes: rmse 0.00139  max resid 0.0121 
## Run 20 stress 0.141 
## ... Procrustes: rmse 0.00372  max resid 0.0341 
## *** Best solution repeated 1 times
```

]

---
maxit
## Решение


```r
ord_mus$stress
```

```
## [1] 0.141
```

```r
ordiplot(ord_mus)
```

![](02_nMDS_files/figure-html/fig-mus-bw-1.png)&lt;!-- --&gt;

--

Но график нужно украсить --- добавить информацию о свойствах мидий.

---

## Украшенный график


Кодируем свойства мидий: горизонт литорали цветом, а сайт --- формой.


```r
# Палитры
pal_col &lt;- c("red", "green", "steelblue")
pal_sh &lt;- c(1, 2, 0)

# Украшенный график
ordiplot(ord_mus, type = "n")
points(ord_mus, col = pal_col[env$Zone], pch = pal_sh[env$Site])
```

![](02_nMDS_files/figure-html/fig-mus-col-1.png)&lt;!-- --&gt;

--

А где же легенда?

---

## Украшенный график с легендой


```r
# Палитры
pal_col &lt;- c("red", "green", "steelblue")
pal_sh &lt;- c(1, 2, 0)
# Украшенный график
ordiplot(ord_mus, type = "n")
points(ord_mus, col = pal_col[env$Zone], pch = pal_sh[env$Site])

# Легенда (пример относительного и абсолютного расположения)
legend("topleft", bty = "n",
       title = "Intertidal levels: ",
       legend = levels(env$Zone), col = pal_col, pch = 15)
legend(x = 3, y = 1.5, xjust = 1, yjust = 1,
       title = "Sites: ",
       legend = levels(env$Site), col = "black", pch = pal_sh)
```

![](02_nMDS_files/figure-html/fig-mus-col-leg-1.png)&lt;!-- --&gt;

--

А как понять, где какие виды паразитов?

---

## Украшенный график с центроидами видов


```r
op &lt;- par(mar = c(3, 3, 0.1, 0.1), mgp = c(2, 1, 0))
ordiplot(ord_mus, type = "n")
points(ord_mus, col = pal_col[env$Zone], pch = pal_sh[env$Site])
legend("topleft", bty = "n",
       title = "Intertidal levels: ",
       legend = levels(env$Zone), col = pal_col, pch = 15)
legend("topright", bty = "n",
       title = "Sites: ",
       legend = levels(env$Site), col = "black", pch = pal_sh)
text(ord_mus, display = "spec", cex = 0.9, col = "grey20")
par(op)
```

![](02_nMDS_files/figure-html/fig-mus-col-leg-centr-1.png)&lt;!-- --&gt;

---

class: middle, center, inverse

# Визуализация ординации в ggplot2

---

## Задание 2

Используя данные, приведенные ниже, постройте график ординации при помощи `ggplot2`.

Покажите 
  - точками --- мидий, 
  - текстом --- центроиды для видов-симбионтов,
  - цветом --- зону литорали, 
  - формой --- сайт,
  - размером маркеров --- размер мидий.


```r
# Координаты точек (мидий)
ord_mus_pt &lt;- data.frame(env, scores(ord_mus, display = "sites"))
head(ord_mus_pt, 2)
```

```
##   Zone Site    L Age NMDS1  NMDS2
## 4 down    S 40.0   3 -1.09 -0.240
## 5 down    S 34.5   4 -1.10 -0.357
```

```r
# Координаты центроидов переменных (видов-симбионтов)
ord_mus_sp &lt;- data.frame(scores(ord_mus, display = "species"))
ord_mus_sp$Species &lt;- rownames(ord_mus_sp)
head(ord_mus_sp, 2)
```

```
##              NMDS1  NMDS2     Species
## Urastomaspp -0.927 -0.306 Urastomaspp
## Renicolaspp  0.864  0.973 Renicolaspp
```

---

## Решение: График с точками


```r
gg_ord_mus &lt;- ggplot() +
  geom_point(data = ord_mus_pt, 
             aes(x = NMDS1, y = NMDS2, colour = Zone, 
                 shape = Site, size = L), alpha = 0.5)
gg_ord_mus
```

![](02_nMDS_files/figure-html/fig-gg-ord-mus-1.png)&lt;!-- --&gt;

---

## Решение: График с центроидами видов


```r
gg_ord_mus_sp &lt;- gg_ord_mus +
  geom_text(data = ord_mus_sp, 
            aes(x = NMDS1, y = NMDS2, 
                label = Species))
gg_ord_mus_sp
```

![](02_nMDS_files/figure-html/fig-gg-ord-mus-sp-1.png)&lt;!-- --&gt;

---

class: middle, center, inverse

# Интерпретация ординации: envfit

---

## Анализ связи с внешними переменными c помощью функции `envfit()`


Функция `envfit()` строит регрессионную модель зависимости переменной среды от координат точек на плоскости ординации:

`$$y_i = \beta_1 \text{NMDS1}_i + \beta_2 \text{NMDS2}_i + \varepsilon_i$$`

Пермутационный тест значимости позволяет работать, когда не выполнены условия применимости регрессии.



---

## Можно подобрать сразу несколько моделей --- &lt;br/&gt;от каждого из факторов своя модель

.scroll-box-20[


```r
ef &lt;- envfit(ord_mus, env[, c("Zone", "Site", "L", "Age")])
ef
```

```
## 
## ***VECTORS
## 
##      NMDS1  NMDS2   r2 Pr(&gt;r)    
## L   -1.000 -0.024 0.19  0.001 ***
## Age  0.774 -0.633 0.04  0.003 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Permutation: free
## Number of permutations: 999
## 
## ***FACTORS:
## 
## Centroids:
##            NMDS1 NMDS2
## Zonedown   -0.65 -0.09
## Zonemiddle -0.14 -0.05
## Zoneup      0.83  0.14
## SiteG       0.19  0.17
## SiteL       0.23 -0.41
## SiteS      -0.42  0.23
## 
## Goodness of fit:
##        r2 Pr(&gt;r)    
## Zone 0.37  0.001 ***
## Site 0.16  0.001 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Permutation: free
## Number of permutations: 999
```

]

---

## Интерпретация результатов `envfit()` для непрерывных переменных


```r
ef$vectors
```

```
##      NMDS1  NMDS2   r2 Pr(&gt;r)    
## L   -1.000 -0.024 0.19  0.001 ***
## Age  0.774 -0.633 0.04  0.003 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Permutation: free
## Number of permutations: 999
```

&lt;br/&gt;

- `MDS1` и `MDS2` --- направление вектора непрерывной переменной (длина вектора переменной пропорциональна корню из коэффициента детерминации для модели, т.е. `\(R\)`).  
- `r2` --- `\(R^2\)` коэффициент детерминации.     
- `Pr(&gt;r)` --- пермутационная оценка статистической значимости.      

---

## Интерпретация результатов `envfit()` для дискретных переменных 

.pull-left[


```r
ef$factors
```

```
## Centroids:
##            NMDS1 NMDS2
## Zonedown   -0.65 -0.09
## Zonemiddle -0.14 -0.05
## Zoneup      0.83  0.14
## SiteG       0.19  0.17
## SiteL       0.23 -0.41
## SiteS      -0.42  0.23
## 
## Goodness of fit:
##        r2 Pr(&gt;r)    
## Zone 0.37  0.001 ***
## Site 0.16  0.001 ***
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Permutation: free
## Number of permutations: 999
```

]

.pull-right[
- `MDS1` и `MDS2` --- координаты центроидов для дискретных факторов  (т.е. положение центра облака точек, относящихся к категории фактора).
- `r2` --- `\(R^2\)` коэффициент детерминации.    
- `Pr(&gt;r)` --- пермутационная оценка статистической значимости. 
]

---

## График с векторами и центроидами, найденными `envfit()`


```r
ordiplot(ord_mus, type = "n")
points(ord_mus, col = pal_col[env$Zone], pch = pal_sh[env$Site])
plot(ef)
```

![](02_nMDS_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

---

## Для ggplot-графика удобно использовать вспомогательный пакет


```r
# install.packages("devtools")
# devtools::install_github("gavinsimpson/ggvegan")
library(ggvegan)
ord_mus_ef &lt;- fortify(ef)
ord_mus_ef
```

```
##        Label     Type  NMDS1   NMDS2
## 1          L   Vector -0.432 -0.0102
## 2        Age   Vector  0.152 -0.1248
## 3   Zonedown Centroid -0.648 -0.0864
## 4 Zonemiddle Centroid -0.144 -0.0524
## 5     Zoneup Centroid  0.830  0.1400
## 6      SiteG Centroid  0.189  0.1695
## 7      SiteL Centroid  0.228 -0.4062
## 8      SiteS Centroid -0.420  0.2253
```

---

## ggplot2 версия графика `envfit()`


```r
gg_ord_mus +
  geom_segment(data = ord_mus_ef[ord_mus_ef$Type == "Vector", ],
               aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm"))) +
  geom_text(data = ord_mus_ef[ord_mus_ef$Type == "Vector", ],
            aes(x = NMDS1, y = NMDS2, label = Label, hjust = 1.1, vjust = 1)) +
  geom_text(data = ord_mus_ef[ord_mus_ef$Type == "Centroid", ],
            aes(x = NMDS1, y = NMDS2, label = Label, hjust = 1.1, vjust = 1))
```

![](02_nMDS_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

## Ограничения `envfit()`

.content-box-red[

__Осторожно!__ `envfit()` основан на предположении о линейном характере связи между внешней переменной и координатами на ординации. Это не всегда так.

]
---

class: middle, center, inverse

# Интерпретация ординации: ordisurf

---

## Анализ связи с внешними переменными c помощью `ordisurf()`



`ordisurf()` применяется, когда зависимость нелинейна.

В основе работы функции --- общая аддитивная модель (General Additive Model, GAM).


`$$Y_i = f(MDS1_i, MDS2_i)$$`

GAM позволяют подобрать нелинейные зависимости, даже если заранее неизвестна их форма.

`ordisurf()` использует пакет `mgcv` для подбора GAM на основе метода тонких пластин (thin plate spline)

---

## График с поверхностью, найденной `ordisurf()`

Изолинии на графике ординации показывают предсказанное значение зависимой переменной для разных участков ординации.


```r
par(mfrow = c(1, 2))
os_L &lt;- ordisurf(ord_mus, env$L, method = "REML")
os_Age &lt;- ordisurf(ord_mus, env$Age, method = "REML")
par(mfrow = c(1, 1))
```

![](02_nMDS_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;

---

## Интерпретация результатов `ordisurf()`

Длина мидий линейно меняется на ординации (эффективное число степеней свободы для сплайна `\(edf=1.96\)`). Зависимость умеренной силы (объясненная девианса 18.7%).


```r
summary(os_L)
```

```
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## y ~ s(x1, x2, k = 10, bs = "tp", fx = FALSE)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   43.410      0.484    89.7   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df   F p-value    
## s(x1,x2) 1.96      9 9.8  &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.183   Deviance explained = 18.7%
## -REML = 1457.7  Scale est. = 92.494    n = 395
```


---

## Интерпретация результатов `ordisurf()`

Возраст мидий меняется нелинейно вдоль ординационных осей (эффективное число степеней свободы для сплайна `\(edf=4.99\)`). Эта зависимость довольно слабая (объясненная девианса 8.97%).


```r
summary(os_Age)
```

```
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## y ~ s(x1, x2, k = 10, bs = "tp", fx = FALSE)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   4.8861     0.0714    68.5   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df    F    p-value    
## s(x1,x2) 5.02      9 3.73 0.00000099 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.0786   Deviance explained = 9.03%
## -REML = 704.93  Scale est. = 2.011     n = 395
```

---

## Для ggplot-графика понадобится добыть данные о контурах


```r
fortify_ordisurf &lt;- function(model) {
  # Fortifies an object of class ordisurf to produce 
  # a dataframe of contour coordinates 
  # for subsequent plotting in ggplot.
  xy &lt;- expand.grid(x = model$grid$x, y = model$grid$y)
  xyz &lt;- cbind(xy, c(model$grid$z))
  names(xyz) &lt;- c("x", "y", "z")
  return(na.omit(xyz))
}

ord_mus_os &lt;- fortify_ordisurf(os_Age)
head(ord_mus_os, 4)
```

```
##         x     y    z
## 9  -0.413 -1.37 4.83
## 10 -0.309 -1.37 4.84
## 11 -0.205 -1.37 4.86
## 12 -0.101 -1.37 4.88
```

---

## ggplot2 версия графика с поверхностью, найденной `ordisurf()`


```r
ggplot(data = ord_mus_os, aes(x = x, y = y, z = z)) +
  stat_contour(aes(colour = after_stat(level))) +
  labs(x = "NMDS1", y = "NMDS2", colour = "Age")
```

![](02_nMDS_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;

---

## Ограничения `ordisurf()`

.content-box-red[
__Осторожно!__ Для использования `ordisurf()` важно, чтобы в ординации участвовало много объектов и они располагались на плоскости ординации более-менее равномерно. Пустоты и отскоки снижают качество предсказаний.
]

---

## Финальный график

![](02_nMDS_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---

## Take-home messages

+ nMDS --- один из методов ординации в пространстве сниженной размерности. При ординации этим методом сохраняются ранги расстояний между объектами.
+ Мера качества ординации называется "стресс".
+ Значения координат не имеют особенного смысла. Имеет значение только взаиморасположение точек.
+ Результат nMDS зависит от выбора меры различия.
+ Существует несколько способов визуализировать на ординации значения внешних переменных. При выборе между `envfit()` и `ordisurf()` обращайте внимание на форму связи.

---

## Литература

+ Borcard, D., Gillet, F., Legendre, P., 2011. Numerical ecology with R. Springer.
+ Legendre, P., Legendre, L., 2012. Numerical ecology. Elsevier.
+ Oksanen, J., 2015. Multivariate analysis of ecological communities in R: vegan tutorial. http://www.cc.oulu.fi/~jarioksa/opetus/metodi/vegantutor.pdf
+ Zuur, A. F., Ieno, E. N., Smith, G. M. Analysing Ecological Data. Springer 2007

---

class: middle, center, inverse

# Самостоятельная работа

---

## Задание 3

**Данные**

1. Растительные сообщества во франции La Mafragh (данные из работы de Belair et al. 1987, данные `mafragh`, пакет `ade4`).
2. Деревья на острове Barro Colorado (данные из работы Condit et al. (2002), данные `BCI`, пакет `vegan`).

Во всех примерах необходимо:    

1. Разобраться с данными.   
2. Построить ординацию объектов (описаний, проб и т.п.).      
3. Визуализировать связь между полученной ординацией и параметрами среды.    
4. Сделать выводы о наиболее важных факторах.    

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "vs",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<!-- https://github.com/fnaufel/xaringan-smartify-->
<script type="text/javascript">
  smartify();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
